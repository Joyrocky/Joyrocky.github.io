<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="true">
  <meta name="baidu-site-verification" content="true">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://blog.zxkidea.top').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":true,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: true,
    pangu: true,
    comments: {"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>



  <meta name="description" content="Ch3:  Basic SQL Query Language 一. Setting up the Database 1. SQL  Datatype CHARACTER(n), CHAR(n)： fixed-length character strings CHARACTER VARYING(n), CHAR VARYING(n)：variable-length character strings">
<meta property="og:type" content="article">
<meta property="og:title" content="DatabaseNotes-Ch3,4">
<meta property="og:url" content="https://blog.zxkidea.top/posts/928c862a.html">
<meta property="og:site_name" content="遇见时光">
<meta property="og:description" content="Ch3:  Basic SQL Query Language 一. Setting up the Database 1. SQL  Datatype CHARACTER(n), CHAR(n)： fixed-length character strings CHARACTER VARYING(n), CHAR VARYING(n)：variable-length character strings">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://image.zxkidea.top/1550455574345.png">
<meta property="og:image" content="https://image.zxkidea.top/1550381521441.png">
<meta property="og:image" content="https://image.zxkidea.top/1550405574789.png">
<meta property="article:published_time" content="2020-02-29T04:24:34.000Z">
<meta property="article:modified_time" content="2021-05-09T08:23:01.881Z">
<meta property="article:author" content="Rocky Zhou">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://image.zxkidea.top/1550455574345.png">

<link rel="canonical" href="https://blog.zxkidea.top/posts/928c862a.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>DatabaseNotes-Ch3,4 | 遇见时光</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="遇见时光" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">

<!-- 动态线条 -->
<script type="text/javascript" src="https://cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script>

<!-- 页面点击烟花 -->
<canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
<script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
<script type="text/javascript" src="/js/fireworks.js"></script>

<!-- 不蒜子 -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">遇见时光</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">Keep Looking , Don't Settle <br> Stay Hungry , Stay Foolish</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/Joyrocky" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.zxkidea.top/posts/928c862a.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat.jpg">
      <meta itemprop="name" content="Rocky Zhou">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="遇见时光">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          DatabaseNotes-Ch3,4
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-29 12:24:34" itemprop="dateCreated datePublished" datetime="2020-02-29T12:24:34+08:00">2020-02-29</time>
            </span>

          <span class="post-meta-divider">|</span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-09 16:23:01" itemprop="dateModified" datetime="2021-05-09T16:23:01+08:00">2021-05-09</time>
              </span>

          <span class="post-meta-divider">|</span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">数据库基础</span>
                  </a>
                </span>
            </span>

          

          <span class="post-meta-divider">|</span>
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/posts/928c862a.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/posts/928c862a.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

          <span class="post-meta-divider">|</span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>30k</span>
            </span>

          <span class="post-meta-divider">|</span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>28 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Ch3-Basic-SQL-Query-Language">Ch3:  Basic SQL Query Language</h2>
<h3 id="一-Setting-up-the-Database">一. Setting up the Database</h3>
<h4 id="1-SQL-Datatype">1. SQL  Datatype</h4>
<p><font color = blue size = 4>CHARACTER(n), CHAR(n)：</font> fixed-length character strings</p>
<p><font color = blue size = 4>CHARACTER VARYING(n), CHAR VARYING(n)：</font>variable-length character strings</p>
<p><font color = blue size = 4>NUMERIC(p, s), DECIMAL(p, s), DEC(p, s):</font></p>
<a id="more"></a>
<p><font color = blue size = 4>Precision:</font> total number of digits</p>
<p><font color = blue size = 4>Scale：</font>number of digits to the right of the decimal point</p>
<p><font color = blue size = 4>INTEGER, INT, SMALLINT</font></p>
<p><font color = blue size = 4>FLOAT§</font></p>
<p><font color = blue size = 4>REAL</font></p>
<p><font color = blue size = 4>DOUBLE PRECISION</font></p>
<br/>
<h4 id="2-Oracle-Datatype">2.Oracle  Datatype</h4>
<p><font color = blue size = 4>Character Datatype</font></p>
<blockquote>
<p>CHAR(n)：fixed-length character strings(1$\leq$ n $\leq$2000)</p>
<p>VARCHAR(n)：variable-length character strings(1$\leq$ n $\leq$ 4000)</p>
<p>LONG：variable-length character data(text data) (maximum size 2GB)</p>
</blockquote>
<br/>
<p><font color = blue size = 4>NUMBER Datatype</font></p>
<blockquote>
<p>NUMBER：fixed and floating-point numbers</p>
<p>NUMBER(precision, scale)</p>
<p>NUMBER(*, scale)</p>
<p>Precision：total number of digits</p>
<p>Scale：number of digits to the right of the decimal point(default value is zero)</p>
<p>Negative Scale：rounds the actual data to the specified number of places to the left of the decimal point</p>
</blockquote>
<br/>
<h4 id="3-SQL-Statement">3.SQL  Statement</h4>
<h5 id="1-SQL-statements-for-table-creation-for-CAP-database">1)  SQL statements for table creation for CAP database</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>  orders (</span><br><span class="line">cid <span class="built_in">CHAR</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">cname <span class="built_in">VARCHAR</span>(<span class="number">13</span>),</span><br><span class="line">city <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">discnt <span class="built_in">REAL</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span>(cid) );</span><br></pre></td></tr></table></figure>
<br/>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>  orders (</span><br><span class="line">ordno <span class="built_in">INTEGER</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="keyword">month</span> <span class="built_in">CHAR</span>(<span class="number">3</span>),</span><br><span class="line">cid <span class="built_in">CHAR</span>(<span class="number">4</span>),</span><br><span class="line">aid <span class="built_in">CHAR</span>(<span class="number">3</span>),</span><br><span class="line">pid <span class="built_in">CHAR</span>(<span class="number">3</span>),</span><br><span class="line">qty <span class="built_in">INTEGER</span>,</span><br><span class="line">dollars <span class="keyword">DOUBLE</span> <span class="keyword">PRECISION</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span>(ordno) );</span><br></pre></td></tr></table></figure>
<br/>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-- MYSQL</span><br><span class="line">create table Student(</span><br><span class="line">    Sno int not null auto_increment primary key,</span><br><span class="line">    Sname varchar(10) not null,</span><br><span class="line">    Sex char(1) not null,</span><br><span class="line">    Sage tinyint(100) not null,</span><br><span class="line">    Sdept char(4) not null)comment &#x3D; &#39;学生表&#39;;</span><br></pre></td></tr></table></figure>
<br/>
<h5 id="2-Select-Statement">2) Select Statement</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  * | colname &#123; , colname ... &#125;</span><br><span class="line"><span class="keyword">FROM</span>  tablename &#123; , tablename ... &#125;</span><br><span class="line">[ <span class="keyword">WHERE</span> search_condition ]</span><br><span class="line">[ <span class="keyword">GROUP</span> <span class="keyword">BY</span> colname &#123; , colname ... &#125;</span><br><span class="line">[ <span class="keyword">HAVING</span> search_condition ] ]</span><br><span class="line">[ <span class="keyword">ORDER</span> <span class="keyword">BY</span> colname [ <span class="keyword">ASC</span> | <span class="keyword">DESC</span> ]</span><br><span class="line">&#123; , colname [ <span class="keyword">ASC</span> | <span class="keyword">DESC</span> ] ... &#125; ];</span><br></pre></td></tr></table></figure>
<br/>
<hr>
<h3 id="二-Simple-Select-Statements">二. Simple Select Statements</h3>
<h4 id="1-Relational-Algebra与SQL语法对比">1. Relational Algebra与SQL语法对比</h4>
<p><font color = blue size = 4>1. Query in relational algebra :</font></p>
<blockquote>
<p><font color = green size = 4>(R where Condition) [A$_1$, A$_2$, …, A$_m$]</font></p>
</blockquote>
<br/>
<p><font color = blue size = 4>Query in SQL:</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> A1, A2,...,Am <span class="keyword">from</span> R <span class="keyword">where</span> Condition;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>2. Query in relational algebra :</font></p>
<blockquote>
<p><font color = green size = 4>((R$_1$ $\times$ R$_2$$\times$…$\times$R$_n$) where Condition) [A$_1$, A$_2$, …, A$_m$]</font></p>
</blockquote>
<br/>
<p><font color = blue size = 4>Query in SQL:</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> A1, A2,...,Am <span class="keyword">from</span> R1, R2,...,Rn <span class="keyword">where</span> Condition;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>3. Query in relational algebra :</font></p>
<blockquote>
<p><font color = green size = 4>Head® = {A$_1$,…,A$_n$,B$_1$,…,B$_k$}, Head(S) = {B$_1$,…,B$_k$, C$_1$,…,C$_m$}</font></p>
<p><font color = green size = 4>((R$\infty$S) where Condition) [A$_1$, A$_2$, …, A$_m$]</font></p>
</blockquote>
<br/>
<p><font color = blue size = 4>Query in SQL:</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> A1, A2,...,Am <span class="keyword">from</span> R, S <span class="keyword">where</span> Condition <span class="keyword">and</span> R.B1 = S.B1 <span class="keyword">and</span> R2.B2 = S.B2 and...and R.Bk = S.Bk;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>4. Query in relational algebra :</font></p>
<blockquote>
<p><font color = green size = 4>(R $\infty$$_{Condition}$S) [A$_1$, A$_2$, …, A$_m$]</font></p>
</blockquote>
<br/>
<p><font color = blue size = 4>Query in SQL:</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> A1, A2,...,Am <span class="keyword">from</span> R,S <span class="keyword">where</span> Condition;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>5. Query in relational algebra :</font></p>
<blockquote>
<p><font color = green size = 4>(AGENTS where city = ‘New York’) [aid, aname]</font></p>
</blockquote>
<br/>
<p><font color = blue size = 4>Query in SQL:</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> aid, aname <span class="keyword">from</span> agents <span class="keyword">where</span> city = <span class="string">'New York'</span>;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>6. Query in relational algebra :</font></p>
<blockquote>
<p><font color = green size = 4>(CUSTOMERS) [cid, cname, city, discnt]</font></p>
</blockquote>
<br/>
<p><font color = blue size = 4>Query in SQL:</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> * <span class="keyword">from</span> Customers;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> cid, cname, city, discnt <span class="keyword">from</span> Customers;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>7. Query in relational algebra :</font></p>
<blockquote>
<p><font color = green size = 4>((C[cid, cname] $\infty$O)$\infty$A) [cname, aname]; </font></p>
<p><font color = green size = 4>((C $\infty$O $\infty$A) where C.cid = O.cid and O.aid = A.aid) [cname, aname]</font></p>
</blockquote>
<br/>
<p><font color = blue size = 4>Query in SQL:</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="keyword">distinct</span> cname, aname <span class="keyword">from</span> customers, orders, agents <span class="keyword">where</span> customers.cid = orders.cid <span class="keyword">and</span> orders.aid = agents.aid;</span><br></pre></td></tr></table></figure>
<br/>
<h4 id="2-Some-Examples">2. Some Examples</h4>
<p><font color = blue size = 4>1. Display all values of customers in table CUSTOMERS.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cid, cname, city, discnt  <span class="keyword">FROM</span>  customers ;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  *  <span class="keyword">FROM</span>  customers ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>2. Retrieve all (cname, aname) pairs where the customer places an order through the agent.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  <span class="keyword">distinct</span>  cname, aname</span><br><span class="line"><span class="keyword">FROM</span>      customers, orders, agents</span><br><span class="line"><span class="keyword">WHERE</span>   customers.cid=orders.cid <span class="keyword">and</span> orders.aid=agents.aid ;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  <span class="keyword">distinct</span>  cname, aname</span><br><span class="line"><span class="keyword">FROM</span>   customers c, orders  o, agents  a  <span class="comment">-- (has alias)</span></span><br><span class="line"><span class="keyword">WHERE</span>   c.cid=o.cid  <span class="keyword">and</span>  o.aid=a.aid ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>3. Get the names of customers who order at least one product priced at $0.50.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cname</span><br><span class="line"><span class="keyword">FROM</span>  products  p, orders  o, customers  c</span><br><span class="line"><span class="keyword">WHERE</span>  price=<span class="number">0.50</span> <span class="keyword">and</span> p.pid=o.pid <span class="keyword">and</span></span><br><span class="line">o.cid=c.cid ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>4. Retrieve customers who place orders only through agent a03.</font></p>
<blockquote>
<p><font color = green>O [cid] - (O where aid &lt;&gt; ‘a03’) [cid]</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  o1.cid</span><br><span class="line"><span class="keyword">FROM</span>    orders  o1</span><br><span class="line"><span class="keyword">WHERE</span>  o1.cid  <span class="keyword">NOT</span> <span class="keyword">IN</span>  (</span><br><span class="line">	<span class="keyword">SELECT</span> o2.cid</span><br><span class="line">	<span class="keyword">FROM</span>  orders  o2</span><br><span class="line">	<span class="keyword">WHERE</span>  o2.aid &lt;&gt; ‘a03’  ) ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>5. List all pairs of customer cids based in the same city.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> c1.cid, c2.cid <span class="keyword">from</span> customers c1, customers c2 <span class="keyword">where</span> c1.city = c2.city <span class="keyword">and</span> c1.cid &lt; c2.cid;</span><br></pre></td></tr></table></figure>
<br/>
<h4 id="3-Table-and-column-alias">3. Table and column alias</h4>
<p><font color = blue size = 4>Table alias in FROM clause</font></p>
<blockquote>
<p><font color = green size = 4>方法1</font>：table_name  as  alias_name</p>
<p><font color = green size = 4>方法2：</font>table_name   alias_name</p>
</blockquote>
<p><font color = blue size = 4>column alias in SELECT clause</font></p>
<blockquote>
<p>column_name  as  alias_name</p>
</blockquote>
<br/>
<h4 id="4-ALL-DISTINCT">4. ALL  |  DISTINCT</h4>
<blockquote>
<p>SELECT  aid, pid  FROM  orders ;</p>
<p>SELECT  <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">distinct</span>  aid, pid  FROM  orders ;</p>
</blockquote>
<br/>
<p><font color = blue size = 4>Find pids of products ordered by at least two customers.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  <span class="keyword">distinct</span>  pid</span><br><span class="line"><span class="keyword">FROM</span>   orders  x1,  orders  x2</span><br><span class="line"><span class="keyword">WHERE</span>   x1.pid = x2.pid <span class="keyword">and</span> x1.cid &lt; x2.cid ;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  <span class="keyword">distinct</span>  pid</span><br><span class="line"><span class="keyword">FROM</span>   orders  x1,  orders  x2</span><br><span class="line"><span class="keyword">WHERE</span>   x1.pid = x2.pid <span class="keyword">and</span> x1.cid &lt;&gt; x2.cid ;</span><br></pre></td></tr></table></figure>
<br/>
<hr>
<h3 id="三-Subqueries">三. Subqueries</h3>
<h4 id="1-The-IN-Predicate">1. The IN Predicate</h4>
<p><font color = blue size = 4>1. Retrieve cids of customers who place orders with agents in Duluth or Dallas.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  <span class="keyword">distinct</span>  cid</span><br><span class="line"><span class="keyword">from</span>    orders  o, agents  a</span><br><span class="line"><span class="keyword">where</span>  a.aid=o.aid  <span class="keyword">and</span></span><br><span class="line">(a.city=‘Duluth’ <span class="keyword">or</span> a.city=‘Dallas’);       <span class="comment">-- Slow</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span>  cid</span><br><span class="line"><span class="keyword">from</span>  orders</span><br><span class="line"><span class="keyword">where</span>   aid <span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">select</span>  aid</span><br><span class="line"><span class="keyword">from</span>  agents</span><br><span class="line"><span class="keyword">where</span>  city= ‘Duluth’  <span class="keyword">or</span>  city=‘Dallas’ );      <span class="comment">-- Fast</span></span><br></pre></td></tr></table></figure>
<br/>
<p><font color =blue size = 4>2. Get all information concerning agents based in Duluth or Dallas.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  *</span><br><span class="line"><span class="keyword">FROM</span>  agents</span><br><span class="line"><span class="keyword">WHERE</span>  city <span class="keyword">IN</span> &#123; ‘Duluth’, ‘Dallas’ &#125; ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>3. Get the names and discounts of all customers who place orders through agents in Duluth or Dallas.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cname,  discnt</span><br><span class="line"><span class="keyword">FROM</span>      customers</span><br><span class="line"><span class="keyword">WHERE</span>  cid  <span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">SELECT</span>  o.cid</span><br><span class="line"><span class="keyword">FROM</span>      orders  o</span><br><span class="line"><span class="keyword">WHERE</span>  o.aid  <span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">SELECT</span>  a.aid</span><br><span class="line"><span class="keyword">FROM</span>      agents  a</span><br><span class="line"><span class="keyword">WHERE</span>  a.city <span class="keyword">IN</span> (‘Duluth’, ‘Dallas’))) ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>4. Find the names of customers who order product p05.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="keyword">distinct</span> cname </span><br><span class="line"><span class="keyword">from</span> customers c, orders o </span><br><span class="line"><span class="keyword">where</span> c.cid = o.cid <span class="keyword">and</span> o.pid = <span class="string">'p05'</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="keyword">distinct</span> cname </span><br><span class="line"><span class="keyword">from</span> customers c </span><br><span class="line"><span class="keyword">where</span> <span class="string">'p05'</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">Select</span> pid <span class="keyword">from</span> orders o</span><br><span class="line">	<span class="keyword">where</span> o.cid = c.id);</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>5. Get cids of customers who place an order through at least one agent who places an order for product p03</font></p>
<blockquote>
<p><font color = green size = 4>T~1~ := (O where pid = ‘p03’) [aid]</font></p>
<p><font color = green size = 4>T~2~ := (T~1~ $\infty $ O) [cid]</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> o2.cid <span class="keyword">from</span> orders o1, orders o2</span><br><span class="line"><span class="keyword">where</span> o1.pid = <span class="string">'p03'</span> <span class="keyword">and</span> o1.aid = o2.pid;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> o2.cid <span class="keyword">from</span> orders o2 <span class="keyword">where</span> o2.aid <span class="keyword">IN</span></span><br><span class="line">(<span class="keyword">select</span> o1.aid <span class="keyword">from</span> orders o1 <span class="keyword">where</span> o1.pid = <span class="string">'p03'</span>);</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>6. Get cids of all customers who <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">have the same discount</span> as any customer in Dallas or Boston.</font></p>
<blockquote>
<p><font color = green size = 4>T~1~ := (C where city = ‘Dallas’ or city = ‘Boston’) [discnt]</font></p>
<p><font color = green size = 4>T~2~ := (T~1~ $\infty $ C) [cid]</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> c2.cid <span class="keyword">from</span> customers c1, customers c2</span><br><span class="line"><span class="keyword">where</span> (c1.city = <span class="string">'Dallas'</span> <span class="keyword">or</span> c1.city = <span class="string">'Boston'</span>) <span class="keyword">and</span> c1.discnt = c2.discnt;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> c2.cid <span class="keyword">from</span> customers c2 <span class="keyword">where</span> c2.discnt <span class="keyword">IN</span></span><br><span class="line">(<span class="keyword">select</span> c1.discnt <span class="keyword">from</span> customers c1 <span class="keyword">where</span> c1.city = <span class="string">'Dallas'</span> <span class="keyword">or</span> c1.city = <span class="string">'Boston'</span>);</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>7. Get pids of products not ordered by any customer living in a city whose name begin with the letter D.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> p.pid <span class="keyword">from</span> products p <span class="keyword">where</span> p.pid <span class="keyword">NOT</span> <span class="keyword">IN</span></span><br><span class="line">(<span class="keyword">select</span> o.pid <span class="keyword">from</span> orders o, customers c <span class="keyword">where</span></span><br><span class="line">o.cid = c.cid <span class="keyword">and</span> c.city <span class="keyword">LIKE</span> <span class="string">'D%'</span>);</span><br></pre></td></tr></table></figure>
<br/>
<blockquote>
<p><font color = red size = 5>注意：IN 操作符允许您在 WHERE 子句中规定多个值。</font></p>
</blockquote>
<br/>
<p><font color = blue size = 4>4. Find ordno values for all orders placed by customers in Duluth through agents in New York.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  ordno</span><br><span class="line"><span class="keyword">FROM</span>  orders</span><br><span class="line"><span class="keyword">WHERE</span>  (cid, aid)  <span class="keyword">IN</span>		<span class="comment">-- IN的多组值的合并判断</span></span><br><span class="line">(<span class="keyword">select</span>  cid, aid</span><br><span class="line"><span class="keyword">from</span>    customers  c,  agents  a</span><br><span class="line"><span class="keyword">where</span>   c.city=‘Duluth’ <span class="keyword">and</span> a.city=‘<span class="keyword">New</span> York’);</span><br></pre></td></tr></table></figure>
<br/>
<h4 id="2-The-Quantified-Comparison-Predicate">2. The Quantified Comparison Predicate</h4>
<p><font color = blue size = 5>expr $\Theta$ { SOME | ANY | ALL } ( subquery )</font></p>
<blockquote>
<p><font color = green size = 4>IN is =SOME，=ANY</font></p>
<p><font color = green size = 4>NOT IN is &lt;&gt;ALL</font></p>
<p><font color = red size = 4>注意：</font><font color = green size = 4>主要用于某一类属性值的比较；或用于替代IN；或求某一类属性最大/最小时的其他属性的值</font></p>
</blockquote>
<br/>
<p><font color = blue size = 4>1. Find aid values of agents with a <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">minimum percent</span> commission.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  aid</span><br><span class="line"><span class="keyword">FROM</span>  agents</span><br><span class="line"><span class="keyword">WHERE</span>  <span class="keyword">percent</span> &lt;= <span class="keyword">ALL</span> (</span><br><span class="line">		<span class="keyword">select</span> <span class="keyword">percent</span> <span class="keyword">from</span> agents  ) ;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> aid</span><br><span class="line"><span class="keyword">From</span> agents</span><br><span class="line"><span class="keyword">Where</span> <span class="keyword">percent</span> <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">Select</span> <span class="keyword">min</span>(<span class="keyword">percent</span>) <span class="keyword">from</span> agents );</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>2. Find all customers who have the same discount as that of any of the customers in Dallas or Boston.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cid,  cname</span><br><span class="line"><span class="keyword">FROM</span>   customers</span><br><span class="line"><span class="keyword">WHERE</span>  discnt = <span class="keyword">SOME</span> (</span><br><span class="line">		<span class="keyword">select</span>  discnt</span><br><span class="line">		<span class="keyword">from</span>   customers</span><br><span class="line">		<span class="keyword">where</span>  city=‘Dallas’  <span class="keyword">or</span>  city=‘Boston’  ) ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>3. Get cid values of customers with discnt smaller than those of any customers who live in Duluth.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cid,  cname</span><br><span class="line"><span class="keyword">FROM</span>   customers</span><br><span class="line"><span class="keyword">WHERE</span>  discnt &lt; <span class="keyword">ALL</span>  (</span><br><span class="line">		<span class="keyword">select</span>  discnt</span><br><span class="line">		<span class="keyword">from</span>   customers</span><br><span class="line">		<span class="keyword">where</span>  city=‘Duluth’  ) ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>4. Find cid values of customers with discnt smaller than a customer who lives in Duluth.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cid</span><br><span class="line"><span class="keyword">FROM</span>   customers</span><br><span class="line"><span class="keyword">WHERE</span>  discnt &lt; <span class="keyword">SOME</span> ( </span><br><span class="line">  		<span class="keyword">SELECT</span>  discnt</span><br><span class="line">		<span class="keyword">FROM</span>  customers</span><br><span class="line">		<span class="keyword">WHERE</span>  city = ‘Duluth’ ) ;</span><br></pre></td></tr></table></figure>
<br/>
<blockquote>
<p><font color = red size = 5>注意：</font></p>
<p><font color = green size = 4>1) &gt; ALL 父查询中的结果集大于子查询中每一个结果集中的值,则为真</font></p>
<p><font color = green size = 4>2) &gt; ANY, SOME 父查询中的结果集大于子查询中任意一个结果集中的值,则为真</font></p>
<p><font color = green size = 4>3) = ANY 与子查询 IN相同</font></p>
<p><font color = green size = 4>4) &lt;&gt; ANY 与 NOT IN 父查询中的结果集不等于子查询中的a或者b或者c,则为真 </font></p>
</blockquote>
<br/>
<h4 id="3-The-EXISTS-Predicate">3. The EXISTS Predicate</h4>
<p><font color = red Size = 5>实例：</font></p>
<p><font color = green size = 4>exists,not exists的使用方法示例，需要的朋友可以参考下。</font></p>
<p><font color = red size = 4>学生表：</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_student</span><br><span class="line">(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">number</span>(<span class="number">8</span>) primary <span class="keyword">key</span>,</span><br><span class="line"><span class="keyword">name</span> <span class="built_in">varchar2</span>(<span class="number">10</span>),</span><br><span class="line">deptment <span class="built_in">number</span>(<span class="number">8</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><font color = red size = 4>选课表：</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> select_course</span><br><span class="line">(</span><br><span class="line"><span class="keyword">ID</span>         <span class="built_in">NUMBER</span>(<span class="number">8</span>) primary <span class="keyword">key</span>,</span><br><span class="line">STUDENT_ID <span class="built_in">NUMBER</span>(<span class="number">8</span>) <span class="keyword">foreign</span> <span class="keyword">key</span> (COURSE_ID) <span class="keyword">references</span> course(<span class="keyword">ID</span>),</span><br><span class="line">COURSE_ID  <span class="built_in">NUMBER</span>(<span class="number">8</span>) <span class="keyword">foreign</span> <span class="keyword">key</span> (STUDENT_ID) <span class="keyword">references</span> student(<span class="keyword">ID</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><font color = red size = 4>课程表：</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> COURSE</span><br><span class="line">(</span><br><span class="line"><span class="keyword">ID</span>     <span class="built_in">NUMBER</span>(<span class="number">8</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">C_NAME <span class="built_in">VARCHAR2</span>(<span class="number">20</span>),</span><br><span class="line">C_NO   <span class="built_in">VARCHAR2</span>(<span class="number">10</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>1.查询选修了所有课程的学生id、name:（即不存在这样一个学生，他有一门课程没有选。）</font></p>
<blockquote>
<p><font color = red>分析：</font></p>
<p>如果有一门课没有选，则此时</p>
<p>(1)select * from select_course sc，t_student ts，course c  where sc.student_id=<a href="http://ts.id" target="_blank" rel="noopener">ts.id</a> and sc.course_id=c.id存在null，<br>
这说明(2)select * from course c 的查询结果中确实有记录不存在(1查询中)，查询结果返回没有选的课程，<br>
此时select * from t_student ts 后的not exists 判断结果为false，不执行查询。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>, <span class="keyword">name</span> <span class="keyword">from</span> t_student ts <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">(<span class="keyword">select</span> * <span class="keyword">from</span> course c <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">(<span class="keyword">select</span> * <span class="keyword">from</span> select_course sc <span class="keyword">where</span> sc.student_id=ts.id <span class="keyword">and</span> sc.course_id=c.id));</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>, <span class="keyword">name</span> <span class="keyword">from</span> t_student ts, </span><br><span class="line">(<span class="keyword">select</span> studentid <span class="keyword">from</span> select_course sc <span class="keyword">where</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span></span><br><span class="line">(<span class="keyword">select</span> * <span class="keyword">from</span> course c <span class="keyword">where</span> c.id = sc.id)) T1 </span><br><span class="line"><span class="keyword">where</span> ts.id = T1.student_id;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>2.查询没有选择所有课程的学生，即没有全选的学生。（存在这样的一个学生，他至少有一门课没有选）</font></p>
<blockquote>
<p><font color = red>分析：</font></p>
<p>只要有一个门没有选，即</p>
<p>select * from select_course sc，t_student ts，courses c where student_id=t_student.id and courses_id=<a href="http://courses.id" target="_blank" rel="noopener">courses.id</a> 有一条为空，</p>
<p>即not exists null 为true,此时select * from courses有查询结果（<a href="http://xn--idcourses-rl6noey88nng8ai15bi81d.id" target="_blank" rel="noopener">id为子查询中的courses.id</a> ），<br>
因此select id,name from t_student 将执行查询（id为子查询中t_student.id ）。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span> <span class="keyword">from</span> t_student <span class="keyword">where</span> <span class="keyword">exists</span></span><br><span class="line">(<span class="keyword">select</span> * <span class="keyword">from</span> course <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">(<span class="keyword">select</span> * <span class="keyword">from</span> select_course sc <span class="keyword">where</span> student_id=t_student.id <span class="keyword">and</span> course_id=course.id));</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">name</span> <span class="keyword">from</span> t_student <span class="keyword">where</span> (<span class="keyword">id</span> ,<span class="keyword">name</span>) <span class="keyword">NOT</span> <span class="keyword">IN</span> </span><br><span class="line">(<span class="keyword">select</span> <span class="keyword">id</span>, <span class="keyword">name</span> <span class="keyword">from</span> t_student ts, </span><br><span class="line">(<span class="keyword">select</span> studentid <span class="keyword">from</span> select_course sc <span class="keyword">where</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span></span><br><span class="line">(<span class="keyword">select</span> * <span class="keyword">from</span> course c <span class="keyword">where</span> c.id = sc.id)) T1 </span><br><span class="line"><span class="keyword">where</span> ts.id = T1.student_id) T2;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>3.查询一门课也没有选的学生。（不存这样的一个学生，他至少选修一门课程）</font></p>
<blockquote>
<p><font color = red>分析：</font></p>
<p>如果他选修了一门select * from course结果集不为空，not exists 判断结果为false;<br>
select id,name from t_student 不执行查询。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span> <span class="keyword">from</span> t_student <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">(<span class="keyword">select</span> * <span class="keyword">from</span> course <span class="keyword">where</span> <span class="keyword">exists</span></span><br><span class="line">(<span class="keyword">select</span> * <span class="keyword">from</span> select_course sc <span class="keyword">where</span> student_id=t_student.id <span class="keyword">and</span> course_id=course.id));</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>, <span class="keyword">name</span> <span class="keyword">from</span> t_student <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">NOT</span> <span class="keyword">IN</span></span><br><span class="line">(<span class="keyword">select</span> student_id <span class="keyword">from</span> select_course );</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>4.查询至少选修了一门课程的学生。（存在这样的一个学生，他至少选修一门课程）</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span> <span class="keyword">from</span> t_student <span class="keyword">where</span> <span class="keyword">exists</span></span><br><span class="line">(<span class="keyword">select</span> * <span class="keyword">from</span> course <span class="keyword">where</span>  <span class="keyword">exists</span></span><br><span class="line">(<span class="keyword">select</span> * <span class="keyword">from</span> select_course sc <span class="keyword">where</span> student_id=t_student.id <span class="keyword">and</span> course_id=course.id));</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>, <span class="keyword">name</span> <span class="keyword">from</span> t_student <span class="keyword">where</span> (<span class="keyword">id</span>, <span class="keyword">name</span>) <span class="keyword">NOT</span> <span class="keyword">IN</span></span><br><span class="line">(<span class="keyword">select</span> <span class="keyword">id</span>, <span class="keyword">name</span> <span class="keyword">from</span> t_student <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">NOT</span> <span class="keyword">IN</span></span><br><span class="line">(<span class="keyword">select</span> studentid <span class="keyword">from</span> select_course));</span><br></pre></td></tr></table></figure>
<br/>
<blockquote>
<p><font color = red>注意：</font><font color = green>在插入记录前，需要检查这条记录是否已经存在，只有当记录不存在时才执行插入操作，可以通过使用 EXISTS 条件句防止插入重复记录。</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> TableIn (ANAME,ASEX) </span><br><span class="line"><span class="keyword">SELECT</span> top <span class="number">1</span> <span class="string">'张三'</span>, <span class="string">'男'</span> <span class="keyword">FROM</span> TableIn</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">not</span> <span class="keyword">exists</span> (<span class="keyword">select</span> * <span class="keyword">from</span> TableIn <span class="keyword">where</span> TableIn.AID = <span class="number">7</span>);</span><br></pre></td></tr></table></figure>
<br/>
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg .tg-9wq8{border-color:inherit;text-align:center;vertical-align:middle}
.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}
.tg .tg-nrix{text-align:center;vertical-align:middle}
.tg .tg-0lax{text-align:left;vertical-align:top}
</style>
<table class="tg">
  <tr>
    <th class="tg-0pky"><span style="font-weight:700">Relational  Algebra</span></th>
    <th class="tg-0pky"><span style="font-weight:700">SQL  Predicate</span></th>
  </tr>
  <tr>
    <td class="tg-nrix" rowspan="3">natural join</td>
    <td class="tg-0lax">IN</td>
  </tr>
  <tr>
    <td class="tg-0lax">=SOME</td>
  </tr>
  <tr>
    <td class="tg-0lax">EXISTS</td>
  </tr>
  <tr>
    <td class="tg-9wq8" rowspan="3">difference</td>
    <td class="tg-0pky">NOT IN</td>
  </tr>
  <tr>
    <td class="tg-0pky">&lt;&gt;ALL</td>
  </tr>
  <tr>
    <td class="tg-0pky">NOT EXISTS</td>
  </tr>
</table>
<br/>
<p><font color = blue size = 4>1. Retrieve all customer names where the customer places an order through agent a05.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span>  <span class="keyword">distinct</span>  c.cname</span><br><span class="line"><span class="keyword">From</span>  customers c</span><br><span class="line"><span class="keyword">Where</span>  <span class="keyword">EXISTS</span>  (</span><br><span class="line">		<span class="keyword">Select</span></span><br><span class="line">		<span class="keyword">From</span>  orders x</span><br><span class="line">		<span class="keyword">Where</span>  c.cid=x.cid  <span class="keyword">and</span>  x.aid=‘a05’ );</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> c.cname </span><br><span class="line"><span class="keyword">from</span> customers c, <span class="keyword">order</span> o <span class="keyword">where</span> o.cid = c.cid <span class="keyword">and</span> o.aid = <span class="string">'a05'</span>;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>2. Find all customer names where the customer does not place an order through agent a05.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cname</span><br><span class="line"><span class="keyword">FROM</span>    customers c</span><br><span class="line"><span class="keyword">WHERE</span>   cid  <span class="keyword">NOT</span> <span class="keyword">IN</span> ( </span><br><span class="line">		<span class="keyword">SELECT</span>  o.cid</span><br><span class="line">		<span class="keyword">FROM</span>  orders  o</span><br><span class="line">		<span class="keyword">WHERE</span>  o.aid = ‘a05’ ) ;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cname</span><br><span class="line"><span class="keyword">FROM</span>    customers  c</span><br><span class="line"><span class="keyword">WHERE</span>   <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">		<span class="keyword">SELECT</span>  *</span><br><span class="line">		<span class="keyword">FROM</span>   orders  o</span><br><span class="line">		<span class="keyword">WHERE</span>   o.cid = c.cid  <span class="keyword">and</span>  o.aid = ‘a05’ ) ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>3. Find cids of all customers who don’t place any order through agent a03.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cid</span><br><span class="line"><span class="keyword">FROM</span>    customers</span><br><span class="line"><span class="keyword">WHERE</span>   cid  <span class="keyword">NOT</span> <span class="keyword">IN</span> ( </span><br><span class="line">        <span class="keyword">SELECT</span>  o.cid</span><br><span class="line">		<span class="keyword">FROM</span>  orders  o</span><br><span class="line">		<span class="keyword">WHERE</span>  o.aid = ‘a03’ ) ;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cid</span><br><span class="line"><span class="keyword">FROM</span>    customers  c</span><br><span class="line"><span class="keyword">WHERE</span>   <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">		<span class="keyword">SELECT</span>  *</span><br><span class="line">		<span class="keyword">FROM</span>  orders  o</span><br><span class="line">		<span class="keyword">WHERE</span>   o.cid = c.cid  <span class="keyword">and</span>  o.aid = ‘a03’ );</span><br></pre></td></tr></table></figure>
<br/>
<blockquote>
<p><font color = red size = 5>注意：</font></p>
<p><font color = green size = 4>EXISTS用于检查子查询是否至少会返回一行数据，该子查询实际上并不返回任何数据，而是返回值True或False</font></p>
</blockquote>
<br/>
<p><font color = blue size = 5>not in和not exists的区别：</font></p>
<p><font color = green>1. not in 只有当子查询中，select 关键字后的字段有not null约束或者有这种暗示时用not in,另外如果主查询中表大，子查询中的表小但是记录多，则应当使用not in,</font></p>
<p><font color = blue size = 4>例如:查询那些班级中没有学生的：</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">class</span> <span class="keyword">where</span> cid <span class="keyword">not</span> <span class="keyword">in</span> </span><br><span class="line">(<span class="keyword">select</span> <span class="keyword">distinct</span> cid <span class="keyword">from</span> stu);</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = green>2. 当表中cid存在null值，not in 不对空值进行处理</font></p>
<p><span style="background: linear-gradient(to right, #f2994a, #f2c94c);">解决:</span></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">class</span> <span class="keyword">where</span> cid <span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">(<span class="keyword">select</span> <span class="keyword">distinct</span> cid <span class="keyword">from</span> stu <span class="keyword">where</span> cid <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<br/>
<blockquote>
<p><font color = green>not in的执行顺序是：是在表中一条记录一条记录的查询(查询每条记录）符合要求的就返回结果集，不符合的就继续查询下一条记录，直到把表中的记录查询完。也就是说为了证明找不到，所以只能查询全部记录才能证明，并没有用到索引。<br>
not exists：如果主查询表中记录少，子查询表中记录多，并有索引。</font></p>
</blockquote>
<p><font color = blue size = 4>例如:查询那些班级中没有学生的</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> class2</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">(<span class="keyword">select</span> * <span class="keyword">from</span> stu1 <span class="keyword">where</span> stu1.cid =class2.cid)</span><br></pre></td></tr></table></figure>
<br/>
<blockquote>
<p><font color = green>not exists的执行顺序是：在表中查询，是根据索引查询的，如果存在就返回true，如果不存在就返回false，不会每条记录都去查询。<br>
之所以要多用not exists，而不用not in，也就是not exists查询的效率远远高与not in查询的效率。</font></p>
</blockquote>
<br/>
<h4 id="4-The-LIKE-Predicate">4. The LIKE Predicate</h4>
<p><img data-src="http://image.zxkidea.top/1550455574345.png" alt="zxk"></p>
<br/>
<p><font color = blue size = 4>1. Get pids of products not ordered by any customer living in a city whose name begin with the letter D.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  p.pid</span><br><span class="line"><span class="keyword">FROM</span>    products  p</span><br><span class="line"><span class="keyword">WHERE</span>   p.pid  <span class="keyword">NOT</span>  <span class="keyword">IN</span>  (</span><br><span class="line">	<span class="keyword">SELECT</span>  o.pid</span><br><span class="line">	<span class="keyword">FROM</span>    orders  o,  customers  c</span><br><span class="line">	<span class="keyword">WHERE</span>   o.cid = c.cid  <span class="keyword">and</span>  c.city <span class="keyword">LIKE</span> ‘D%’  ) ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>2. Retrieve cid values of customers whose cname <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">does not have a third letter</span> equal to ‘%’.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span>  cid</span><br><span class="line"><span class="keyword">From</span>  customers</span><br><span class="line"><span class="keyword">Where</span>  cname  <span class="keyword">NOT</span> <span class="keyword">LIKE</span>  ‘_ _ \ % %’</span><br><span class="line">		ESCAPE  ‘ \ ’ ;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color = red size = 4>注意：% 原为通配符，指定用 ’ \ '符号来说明跟在其后面的通配符字符为普通字符。</font></p>
</blockquote>
<br/>
<p><font color = blue size = 4>3. Retrieve cid values of customers whose cname <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">begins “Tip_”</span> and has an arbitrary number of characters following.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span>  cid</span><br><span class="line"><span class="keyword">From</span>  customers</span><br><span class="line"><span class="keyword">Where</span>  cname  <span class="keyword">LIKE</span>  ‘Tip\_%’</span><br><span class="line">ESCAPE  <span class="string">'\'</span> ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>4. Retrieve cid values of customers whose cname <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">starts with the sequence “ab\”</span>.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span>  *</span><br><span class="line"><span class="keyword">From</span>  customers</span><br><span class="line"><span class="keyword">Where</span>  cname  <span class="keyword">LIKE</span>  ‘ab\ \%’  ESCAPE  ‘\’ ;</span><br></pre></td></tr></table></figure>
<p><span style="background: linear-gradient(to right, #f2994a, #f2c94c);"><font color = green size = 4>( 连续的两个转义指示字符表示 ‘转义指示符 ’自己)</font></span></p>
<br/>
<blockquote>
<p><font color = red size = 5>注意：</font></p>
<p><font color = green size = 4>‘A_Z’: 所有以 ‘A’ 起头，另一个任何值的字原，且以 ‘Z’ 为结尾的字串。</font></p>
<p><font color = green size = 4>‘ABC%’: 所有以 ‘ABC’ 起头的字串。</font></p>
<p><font color = green size = 4>‘%XYZ’: 所有以 ‘XYZ’ 结尾的字串。</font></p>
<p><font color = green size = 4>‘%AN%’: 所有含有 ‘AN’ 这个套式的字串。</font></p>
<p><font color = green size = 4>使用   ESCAPE   关键字定义转义符。</font></p>
<p><font color = green size = 4>WHERE   ColumnA   LIKE   ‘%5/%%’   ESCAPE   ‘/’   即 ‘/’为转义字符，第二个‘%’为普通字符，第一、第三个为通配符。</font></p>
</blockquote>
<br/>
<h4 id="5-The-NULL-Predicate">5. The NULL Predicate</h4>
<blockquote>
<p>NULL表示不可知不确定，NULL不与任何值相等（包括其本身）</p>
<p>IS NULL 判断某个字符是否为空，并不代表空字符或者是0</p>
<p>=NULL 是判断某个值是否等于NULL</p>
<p>总之，要判断一个数是否等于NULL只能用 IS NULL 或者 IS NOT NULL 来判断</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 选择非空列</span><br><span class="line">select * from tableName where colName IS NOT NULL;</span><br><span class="line"></span><br><span class="line">-- 删除列为NULL的行</span><br><span class="line">delete from tableName where colName IS NULL;</span><br></pre></td></tr></table></figure>
<br>
<h4 id="6-Example-of-Subqueries">6.Example  of Subqueries</h4>
<p><font color = blue size = 4>1. Retrieve all customer names where the customer places an order through agent a05.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  <span class="keyword">distinct</span>  cname</span><br><span class="line"><span class="keyword">FROM</span>    customers c, orders o</span><br><span class="line"><span class="keyword">WHERE</span>   c.cid = o.cid  <span class="keyword">and</span>  o.aid = ‘a05’ ;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  <span class="keyword">distinct</span>  cname</span><br><span class="line"><span class="keyword">FROM</span>    customers</span><br><span class="line"><span class="keyword">WHERE</span>   cid   <span class="keyword">IN</span></span><br><span class="line">(<span class="keyword">SELECT</span> cid  <span class="keyword">FROM</span> orders  <span class="keyword">WHERE</span> aid=‘a05’) ;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  <span class="keyword">distinct</span>  cname</span><br><span class="line"><span class="keyword">FROM</span>    customers  c</span><br><span class="line"><span class="keyword">WHERE</span>   <span class="keyword">EXISTS</span> </span><br><span class="line">(<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> orders o <span class="keyword">WHERE</span>  o.cid=c.cid <span class="keyword">and</span> o.aid=‘a05’) ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>2. Get cids of customers who order <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">both</span> products p01 and p07.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  o1.cid  <span class="keyword">FROM</span>  orders  o1, orders  o2</span><br><span class="line"><span class="keyword">WHERE</span>  o1.cid=o2.cid  <span class="keyword">and</span></span><br><span class="line">o1.pid=‘p01’  <span class="keyword">and</span>  o2.pid=‘p07’;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  o1.cid  <span class="keyword">FROM</span> orders  o1</span><br><span class="line"><span class="keyword">WHERE</span>  o1.pid=‘p01’ <span class="keyword">and</span> o1.cid <span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">SELECT</span>  o2.cid   <span class="keyword">FROM</span>  orders  o2</span><br><span class="line"><span class="keyword">WHERE</span>  o2.pid=‘p07’ );</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> cid <span class="keyword">from</span> orders <span class="keyword">where</span> pid = <span class="string">'p01'</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">Select</span> cid <span class="keyword">from</span> orders <span class="keyword">where</span> pid = <span class="string">'p07'</span>;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>3. Get cids of customers who <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">place an order</span> through at least one agent who <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">places an order</span> for product p03.</font></p>
<blockquote>
<p><font color = green size = 4>T1 := (O where pid = ‘p03’)[aid]</font></p>
<p><font color = green size = 4>T2 := (T1 $\infty $ O) [cid]</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  o2.cid</span><br><span class="line"><span class="keyword">FROM</span>    orders  o1,  orders  o2</span><br><span class="line"><span class="keyword">WHERE</span>   o1.pid=‘p03’  <span class="keyword">and</span>  o1.aid=o2.aid;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>4. Get cids of all customers who <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">have the same discount</span> as any customer in Dallas or Boston.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  c1.cid</span><br><span class="line"><span class="keyword">FROM</span>    customers  c1,  customers  c2</span><br><span class="line"><span class="keyword">WHERE</span>  ( c1.city = ‘Dallas’  <span class="keyword">or</span>  c1.city = ‘Boston’ )</span><br><span class="line"><span class="keyword">and</span>  c1.discnt = c2.discnt <span class="keyword">and</span> c1.cid &lt; c2.cid;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>5. Find all customer names where the customer <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">does not place</span> an order through agent a05.</font></p>
<blockquote>
<p><font color = green size = 4>((C[cid] – (O where aid = ‘a05’) [cid]) $\infty $ C) [cname]</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cname</span><br><span class="line"><span class="keyword">FROM</span>  customers</span><br><span class="line"><span class="keyword">WHERE</span>  cid  <span class="keyword">NOT</span> <span class="keyword">IN</span> ( </span><br><span class="line">    <span class="keyword">SELECT</span>  o.cid</span><br><span class="line">	<span class="keyword">FROM</span>  orders  o</span><br><span class="line">	<span class="keyword">WHERE</span>  o.aid = ‘a05’ ) ;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cname</span><br><span class="line"><span class="keyword">FROM</span>    customers  c</span><br><span class="line"><span class="keyword">WHERE</span>   <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line"><span class="keyword">SELECT</span>  *</span><br><span class="line"><span class="keyword">FROM</span>   orders  o</span><br><span class="line"><span class="keyword">WHERE</span>  o.cid = c.cid  <span class="keyword">and</span>  o.aid = ‘a05’ ) ;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color = red size = 4>注意：</font><font color = green size = 4>此处可以看见NOT EXISTS需要将索引联结起来；而NOT IN则不需要</font></p>
</blockquote>
<br/>
<p><font color = blue size = 4>6. Find all cid, aid pairs where the customer <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">does not place</span> an order through the agent.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cid,  aid</span><br><span class="line"><span class="keyword">FROM</span>  customers  c,  agents  a</span><br><span class="line"><span class="keyword">WHERE</span>  <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line"><span class="keyword">SELECT</span>  *</span><br><span class="line"><span class="keyword">FROM</span>  orders  o</span><br><span class="line"><span class="keyword">WHERE</span>  o.cid = c.cid  <span class="keyword">and</span>  o.aid = a.aid );</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cid,  aid</span><br><span class="line"><span class="keyword">FROM</span>  customers  c,  agents  a</span><br><span class="line"><span class="keyword">WHERE</span>   (cid,  aid)  <span class="keyword">NOT</span>  <span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">SELECT</span>  o.cid,  o.aid  <span class="keyword">FROM</span>  orders  o );</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color = red size = 4>注意：</font><font color = green size = 4>此处也可以看见NOT EXISTS需要将索引联结起来；而NOT IN则不需要</font></p>
</blockquote>
<br/>
<p><font color = blue size = 4>7. Get the names of customers who order <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">at least one</span> product priced at $0.50.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cname</span><br><span class="line"><span class="keyword">FROM</span>  products  p, orders  o, customers  c</span><br><span class="line"><span class="keyword">WHERE</span>  price=<span class="number">0.50</span> <span class="keyword">and</span> p.pid=o.pid <span class="keyword">and</span></span><br><span class="line">o.cid=c.cid ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>8. Retrieve customers who place orders <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">only through</span> agent a03</font></p>
<blockquote>
<p><font color = green size = 4>O [cid] - (O where aid &lt;&gt; ‘a03’) [cid]</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  o1.cid</span><br><span class="line"><span class="keyword">FROM</span>    orders  o1</span><br><span class="line"><span class="keyword">WHERE</span>  o1.cid  <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">SELECT</span> o2.cid</span><br><span class="line"><span class="keyword">FROM</span>  orders  o2</span><br><span class="line"><span class="keyword">WHERE</span>  o2.aid &lt;&gt; ‘a03’) ;</span><br></pre></td></tr></table></figure>
<br/>
<hr>
<h3 id="四-UNION-Operators-and-FOR-ALL-Conditions">四.UNION Operators and FOR ALL Conditions</h3>
<h4 id="1-The-UNION-Operator-并集-交集拓展">1. The UNION Operator(并集/交集拓展)</h4>
<p><font color = blue size = 4>1. Retrieve all cities where either a customer or an agent, or both, is based.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  city  <span class="keyword">from</span>  customers </span><br><span class="line"><span class="keyword">UNION</span> </span><br><span class="line"><span class="keyword">select</span>  city  <span class="keyword">from</span>  agents</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  city  <span class="keyword">from</span>  customers </span><br><span class="line"><span class="keyword">UNION</span> </span><br><span class="line"><span class="keyword">select</span>  city  <span class="keyword">from</span>  agents</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  city  <span class="keyword">from</span>  customers</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">select</span>  city  <span class="keyword">from</span>  agents</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color = red size = 4>注意：</font></p>
<p><font color = green size = 4>如果我们需要将两个或多个select语句的结果作为一个整体显示出来，这是我们就需要用到union或者union all关键字。</font></p>
<p><font color = green size = 4>union和union all的区别是,union会自动压缩多个结果集合中的重复结果，而union all则将所有的结果全部显示出来，不管是不是重复。</font></p>
</blockquote>
<br/>
<p><font color = red size = 5>拓展：求交集</font></p>
<p><font color = blue size = 4>1. Get cid values of customers who order both products p01 and p07.</font></p>
<blockquote>
<p><font color = green size = 4>(Orders where pid = ‘p01’) [cid] $\cap$ (Orders where pid = ‘p07’) [cid]</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> o1.cid <span class="keyword">from</span> Orders o1</span><br><span class="line"><span class="keyword">where</span> pid = <span class="string">'p01'</span> <span class="keyword">and</span> pid <span class="keyword">IN</span></span><br><span class="line">(<span class="keyword">select</span> o2.cid <span class="keyword">from</span> Orders o2</span><br><span class="line"><span class="keyword">where</span> pid = <span class="string">'p02'</span> <span class="keyword">and</span> o1.cid = o2.cid);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> cid <span class="keyword">from</span> (<span class="keyword">select</span> cid <span class="keyword">from</span> Orders <span class="keyword">where</span> pid = <span class="string">'p01'</span>) t1,</span><br><span class="line">(<span class="keyword">select</span> cid <span class="keyword">from</span> Orders <span class="keyword">where</span> pid = <span class="string">'p07'</span>) t2</span><br><span class="line"><span class="keyword">where</span> t1.cid = t2.cid;</span><br></pre></td></tr></table></figure>
<br/>
<h4 id="2-The-span-style-background-linear-gradient-to-right-f2994a-f2c94c-Division-Operation-span-in-Relational-Algebra">2. The <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">Division Operation</span> in Relational Algebra</h4>
<blockquote>
<p><font color = red size = 4>注意：</font></p>
<p><font color = green size = 4>1. 可将关系代数中的除法运算<font color = red>转换为</font>SQL语句的NOT EXISTS<font color = red>二重</font>条件判断</font></p>
<p><font color = green size = 4>2. 写出关系代数式(包含除法运算)<font color = red>根据表关系</font>构造NOT EXISTS二重条件判断</font></p>
<p><font color = green size = 4>3. NOT EXISTS判断为Select *，且需要建立索引</font></p>
</blockquote>
<br/>
<p><font color = blue size = 4>1. Find cids of customers who place orders with <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">ALL agents</span> based in New York.</font></p>
<blockquote>
<p><font color = green size = 4>o[cid, aid] $\div$ (a where city=‘New York’)[aid]</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  c.cid</span><br><span class="line"><span class="keyword">FROM</span>    customers  c</span><br><span class="line"><span class="keyword">WHERE</span>  	<span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    	<span class="keyword">SELECT</span>  *</span><br><span class="line">		<span class="keyword">FROM</span>  agents  a</span><br><span class="line">		<span class="keyword">WHERE</span>  a.city = ‘<span class="keyword">New</span> York’  <span class="keyword">and</span>  <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">		<span class="keyword">SELECT</span>  *</span><br><span class="line">		<span class="keyword">FROM</span>  orders  o</span><br><span class="line">		<span class="keyword">WHERE</span>  o.cid = c.cid  <span class="keyword">and</span>  o.aid = a.aid ) );</span><br></pre></td></tr></table></figure>
<br/>
<p><img data-src="https://image.zxkidea.top/1550381521441.png" alt="zxk"></p>
<br/>
<p><font color = blue size = 4>2. Get the aid values of agents in New York or Duluth who place orders for <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">all products</span> costing more than a dollar.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  aid</span><br><span class="line"><span class="keyword">FROM</span>    agents  a</span><br><span class="line"><span class="keyword">WHERE</span>  (city=‘<span class="keyword">New</span> York’ <span class="keyword">or</span> city=‘Duluth’) <span class="keyword">and</span></span><br><span class="line"><span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span>  *</span><br><span class="line">	<span class="keyword">FROM</span>  products  p</span><br><span class="line">	<span class="keyword">WHERE</span>  p.price &gt; <span class="number">1</span>  <span class="keyword">and</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span>  *</span><br><span class="line">	<span class="keyword">FROM</span>  orders  o</span><br><span class="line">	<span class="keyword">WHERE</span>  o.aid=a.aid <span class="keyword">and</span> o.pid=p.pid  ) );</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>3. Find aid values of agents who <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">place orders for product p01</span> as well as for <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">all products</span> costing more than a dollar.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  aid    <span class="keyword">FROM</span>  agents  a</span><br><span class="line"><span class="keyword">WHERE</span>   aid <span class="keyword">IN</span> (  </span><br><span class="line">    <span class="keyword">select</span> aid <span class="keyword">from</span> orders</span><br><span class="line">	<span class="keyword">where</span> pid=‘p01’ )</span><br><span class="line">	<span class="keyword">and</span>  <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span>  *    <span class="keyword">FROM</span>  products  p</span><br><span class="line">	<span class="keyword">WHERE</span>  p.price &gt; <span class="number">1</span>  <span class="keyword">and</span>  <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span>  *    <span class="keyword">FROM</span>  orders  o</span><br><span class="line">	<span class="keyword">WHERE</span>  o.aid=a.aid <span class="keyword">and</span> o.pid=p.pid));</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>4. Get cids of customers who order <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">all products</span> that <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">anybody orders</span>.</font></p>
<blockquote>
<p><font color = green size = 4>O[cid, pid] ÷ O[pid]</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  c.cid  <span class="keyword">FROM</span>  customers  c</span><br><span class="line"><span class="keyword">WHERE</span>  <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">		<span class="keyword">SELECT</span>  *  <span class="keyword">FROM</span> orders  o1</span><br><span class="line">		<span class="keyword">WHERE</span>  <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">		<span class="keyword">SELECT</span>  *  <span class="keyword">FROM</span> orders  o2</span><br><span class="line">		<span class="keyword">WHERE</span>  o2.cid=c.cid  <span class="keyword">and</span>  o2.pid=o1.pid ));</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>5. Get aids of agents who take orders on <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">at least</span> that set of products ordered by c004.</font></p>
<blockquote>
<p><font color = green size = 4>O[aid, pid] ÷ (O where cid = ‘c004’)[pid]</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  a.aid</span><br><span class="line"><span class="keyword">FROM</span>  agents  a</span><br><span class="line"><span class="keyword">WHERE</span>  <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">		<span class="keyword">SELECT</span>  *</span><br><span class="line">		<span class="keyword">FROM</span>  orders o1</span><br><span class="line">		<span class="keyword">WHERE</span>  o1.cid=‘c004’  <span class="keyword">and</span>  <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">		<span class="keyword">SELECT</span>  *</span><br><span class="line">		<span class="keyword">FROM</span>  orders o2</span><br><span class="line">		<span class="keyword">WHERE</span>  o2.aid=a.aid  <span class="keyword">and</span>  o2.pid=o1.pid  ));</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>6. Get cids for customers with the following property: </font></p>
<p><font color = blue size = 4>If customer c006 orders a product x through agent y, so the customer orders the product x through the agent y.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  cid</span><br><span class="line"><span class="keyword">FROM</span>    customers  c</span><br><span class="line"><span class="keyword">WHERE</span>   <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">		<span class="keyword">SELECT</span>  *</span><br><span class="line">		<span class="keyword">FROM</span>   orders o1</span><br><span class="line">		<span class="keyword">WHERE</span>   o1.cid=‘c006’  <span class="keyword">and</span>  <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">		<span class="keyword">SELECT</span>  *</span><br><span class="line">		<span class="keyword">FROM</span>  orders o2</span><br><span class="line">		<span class="keyword">WHERE</span>   o2.cid = c.cid  <span class="keyword">and</span>  o2.pid = o1.pid</span><br><span class="line">	   	<span class="keyword">and</span>  o2.aid = o1.aid  ) );</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>7. Get aids of agents who place orders for <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">all customers</span> who place orders for <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">all products</span> costing more than a dollar through the agent.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  aid</span><br><span class="line"><span class="keyword">FROM</span>  agents  a</span><br><span class="line"><span class="keyword">WHERE</span>  <span class="keyword">not</span> <span class="keyword">exists</span> (</span><br><span class="line">		<span class="keyword">SELECT</span>  *</span><br><span class="line">		<span class="keyword">FROM</span>  customers  c,  products  p</span><br><span class="line">		<span class="keyword">WHERE</span>  p.price &gt; <span class="number">1</span>  <span class="keyword">and</span>  <span class="keyword">not</span> <span class="keyword">exists</span> (</span><br><span class="line">		<span class="keyword">SELECT</span>  *</span><br><span class="line">		<span class="keyword">FROM</span>  orders  x</span><br><span class="line">		<span class="keyword">WHERE</span>   x.cid = c.cid  <span class="keyword">and</span>  x.pid = p.pid</span><br><span class="line">	  	<span class="keyword">and</span>  x.aid = a.aid  ) );</span><br></pre></td></tr></table></figure>
<br/>
<blockquote>
<p><font color = red size = 5>注意：</font></p>
<p><font color = green size = 4>Relational Algebra：</font></p>
<p>R(x, y) $\div$ S(y)</p>
<p><font color = green size = 4>Relational Calculus：</font></p>
<p>$\forall$z ( $\exists$ y ( P(z, y) )) $\longleftrightarrow$ $\nexists$z ( $\nexists$ y ( P(z, y) ))</p>
</blockquote>
<br/>
<h4 id="3-Set-Functions-in-SQL-聚合函数">3.  Set Functions in SQL(聚合函数)</h4>
<p><img data-src="https://image.zxkidea.top/1550405574789.png" alt="zxk"></p>
<br/>
<p><font color = blue size = 4>1. Get the total dollar amount of all orders.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  <span class="keyword">sum</span> ( dollars )  <span class="keyword">as</span>  totaldollars</span><br><span class="line"><span class="keyword">from</span>  orders;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>2. Get the total quantity of product p03 that has been ordered.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  <span class="keyword">sum</span> ( qty )  <span class="keyword">as</span>  TOTAL</span><br><span class="line"><span class="keyword">from</span>  orders</span><br><span class="line"><span class="keyword">where</span>  pid = ‘p03’;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>3. List the cid values of all customers who have a discount <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">less than</span> the maximum discount.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  cid</span><br><span class="line"><span class="keyword">from</span>  customers  c1</span><br><span class="line"><span class="keyword">where</span>  discnt &lt; <span class="keyword">all</span> ( </span><br><span class="line">    <span class="keyword">select</span>  <span class="keyword">max</span>(c2.discnt)</span><br><span class="line">	<span class="keyword">from</span>  customers  c2 );</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>4. Find products ordered by <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">at least</span> two customers.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>   p.pid</span><br><span class="line"><span class="keyword">from</span>     products  p</span><br><span class="line"><span class="keyword">where</span>  <span class="number">2</span> &lt;= <span class="keyword">ALL</span> (   </span><br><span class="line">    <span class="keyword">select</span>  <span class="keyword">count</span> ( <span class="keyword">distinct</span>  cid )</span><br><span class="line">	<span class="keyword">from</span>     orders  o</span><br><span class="line">	<span class="keyword">where</span>  o.pid = p.pid );</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color = red size = 4>注意：</font></p>
<p><font color = green size = 4>1. 此处表示至少有两个顾客购买的产品；</font></p>
<p><font color = green size = 4>2. 具体语句运行过程：</font></p>
<p><font color = brown size = 4>a. 先将两表连接；</font></p>
<p><font color = brown size = 4>b. 然后返回相等pid下cid不重复的记录数；</font></p>
<p><font color = brown size = 4>c. 若相同pid的该记录数大于2，则返回其pid；</font></p>
</blockquote>
<br/>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> p.pid <span class="keyword">from</span> (</span><br><span class="line">	<span class="keyword">select</span> pid, <span class="keyword">count</span>(<span class="keyword">distinct</span> cid) dcd </span><br><span class="line">    <span class="keyword">from</span> orders <span class="keyword">as</span> o <span class="keyword">group</span> <span class="keyword">by</span> pid) t, products p </span><br><span class="line"><span class="keyword">where</span> t.pid = t.pid <span class="keyword">and</span> t.dcd &gt;= <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color = red size = 4>注意：</font></p>
<p><font color = green size = 4>1. 先将orders表pid，cid不重复记录分组构造新表t；</font></p>
<p><font color = green size = 4>2. 再将produsts表与t表连接，最后返回cid不重复记录数大于2的pid；</font></p>
</blockquote>
<br/>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  pid</span><br><span class="line"><span class="keyword">FROM</span>    orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>  pid</span><br><span class="line"><span class="keyword">HAVING</span>   <span class="keyword">count</span> ( <span class="keyword">distinct</span>  cid ) &gt;= <span class="number">2</span> ;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color = red size = 4>注意：</font><font color = green size = 4>使用Group By对pid进行分组，Having对cid进行过滤</font></p>
</blockquote>
<br/>
<blockquote>
<p><font color = red size = 4>注意：</font></p>
<p><font color = green size = 4>1. count(*)：获取数量</font></p>
<p><font color = green size = 4>2. sum()：求和（这里要注意求和是忽略null值的，null与其他数值相加结果为null，所以可以通过ifnull(xxx,0)将null的值赋为0</font></p>
<p><font color = green size = 4>3. avg()：求平均数</font></p>
<p><font color = green size = 4>4. max()：求最大值</font></p>
<p><font color = green size = 4>5. min()：求最小值</font></p>
</blockquote>
<br/>
<h4 id="4-Groups-of-Rows-in-SQL">4. Groups of Rows in SQL</h4>
<p><font color = blue size = 4>GROUP BY clause &amp; HAVING clause</font></p>
<blockquote>
<p><em><strong><font color = red size = 4>SQL语句的执行顺序：</font></strong></em></p>
<p><font color = red size = 4>from–where–group by–having–select–order by</font></p>
<p>from：需要从哪个数据表检索数据<br>
where：过滤表中数据的条件<br>
group by：如何将上面过滤出的数据分组<br>
having：对上面已经分组的数据进行过滤的条件<br>
select：查看结果集中的哪个列，或列的计算结果<br>
order by：按照什么样的顺序来查看返回的数据</p>
</blockquote>
<br/>
<p><font color = blue size = 4>1) GROUP BY</font></p>
<ul>
<li>
<p>GROUP BY语句用来与聚合函数(aggregate functions such as COUNT, SUM, AVG, MIN, or MAX.)联合使用来得到一个或多个列的结果集。</p>
</li>
<li>
<p>因为聚合函数通过作用于一组数据而只返回一个单个值，因此，在SELECT语句中出现的元素要么为一个聚合函数的输入值，要么为GROUP BY语句的参数，否则会出错。</p>
</li>
</ul>
<br/>
<p><font color = blue size = 4>例如，对于上面提到的表格，我们做一个这样的查询：</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">COUNT</span>(course) <span class="keyword">as</span> numcourse, score</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color = green size = 4>此时查询便会出错，错误提示如下：</font></p>
<p><font color = green size = 4>Column ‘student.score’ is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.</font></p>
<p><font color = green size = 4>出现以上错误的原因是因为一个学生id对应多个分数，如果我们简单的在</font></p>
<p><font color = green size = 4>SELECT语句中写上score，则无法判断应该输出哪一个分数。如果想用score作为</font></p>
<p><font color = green size = 4>select语句的参数可以将它用作一个聚合函数的输入值，如下例，我们可以得到每个</font></p>
<p><font color = green size = 4>学生所选的课程门数以及每个学生的平均分数：</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">COUNT</span>(course) <span class="keyword">as</span> numcourse, <span class="keyword">AVG</span>(score) <span class="keyword">as</span> avgscore</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>1. Find the agent name and aid, and the product name and pid, together with the total quantity each agent supplies of that product to customers c002 and c003.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  a.aid, a.aname, p.pid, p.pname, <span class="keyword">sum</span>(qty)</span><br><span class="line"><span class="keyword">FROM</span>  agents  a, products  p, orders  o</span><br><span class="line"><span class="keyword">WHERE</span>  a.aid = o.aid <span class="keyword">and</span> p.pid = o.pid <span class="keyword">and</span></span><br><span class="line">o.cid <span class="keyword">IN</span> (<span class="string">'c002'</span>,<span class="string">'c003'</span>)</span><br><span class="line"><span class="keyword">GROUP</span>  <span class="keyword">BY</span>  a.aid, a.aname, p.pid, p.pname</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color = red size = 4>注意：</font><font color = green size = 4>多表连接也可以使用Group By进行分组</font></p>
</blockquote>
<br/>
<p><font color = red size = 4>2.对某个字段分组且进行数据统计，可使用count(*)技巧</font></p>
<p><font color = blue>例如说明现在有一个这样的表：每个部门有多少人 就要用到分组的技术</font></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select DepartmentID as &#39;部门名称&#39;,</span><br><span class="line">COUNT(*) as &#39;个数&#39; from BasicDepartment group by DepartmentID</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这个就是使用了group by +字段进行了分组，其中我们就可以理解为我们按照了部门的名称ID，DepartmentID将数据集进行了分组；然后再进行各个组的统计数据分别有多少；<br>
<span style="background: linear-gradient(to right, #f2994a, #f2c94c);">通俗一点说</span>：group by 字段1，字段2。。。(整个表中不止这两个字段)表示数据集中字段1相等，字段2也相等的数据归为一组，只显示一条数据。那么你可以对字段3进行统计（求和，求平均值等）;</p>
</blockquote>
<br/>
<p><font color = red size = 4>3.MySQL中group by的时候字段不加聚合函数的情况</font></p>
<blockquote>
<p>首先对于不加聚合函数的sql语句来说，它的功能<span style="background: linear-gradient(to right, #f2994a, #f2c94c);">结合了limit</span>来得出结果，仔细想想的时候有点Oracle分析函数的味道，limit的时候得到的并不是最大最小的值(元素按照原来在<span style="background: linear-gradient(to right, #f2994a, #f2c94c);">表中的默认顺序结合分组</span>)，而是某一下group by结果集中第一行，也就是刚才说的<span style="background: linear-gradient(to right, #74ebd5, #acb6e5);">相当于先group by， 然后在每个group by下面进行limit 1</span>。</p>
</blockquote>
<br/>
<blockquote>
<p>其次，刚才还说了常规的group by结合聚合函数的时候，选择的字段除了聚合函数外，必须在group by中存在，但是在mysql中不是这样了，它具有<span style="background: linear-gradient(to right, #f2994a, #f2c94c);">隐含字段</span>的功能，例如：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select a,b,c,count(*) from test1 group by a,b;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">a</th>
<th style="text-align:center">b</th>
<th style="text-align:center">c</th>
<th style="text-align:center">count(*)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">3</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">2</td>
<td style="text-align:center">5</td>
<td style="text-align:center">3</td>
</tr>
</tbody>
</table>
<blockquote>
<p><font color = red>注意：</font>对于没有选择的字段，上面是c，c的值还是和上面说到的一样，是根据得到的结果集然后根据每个group by 进行limit 1得到的结果。</p>
</blockquote>
<br/>
<p><font color = blue size = 4>2) HAVING</font></p>
<ul>
<li>
<p>HAVING语句通常与GROUP BY语句联合使用，用来过滤由GROUP BY语句返回的记录集。</p>
</li>
<li>
<p>HAVING语句的存在弥补了WHERE关键字不能与聚合函数联合使用的不足（只能接聚合函数进行筛选）。</p>
</li>
</ul>
<br/>
<p><font color = blue size = 4>1. Find all product and agent IDs and the total quantity ordered of the product by the agent, when this quantity exceeds 1000.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  pid,  aid,  <span class="keyword">sum</span>(qty)  <span class="keyword">as</span>  total</span><br><span class="line"><span class="keyword">FROM</span>    orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>  pid,  aid</span><br><span class="line"><span class="keyword">HAVING</span>  <span class="keyword">sum</span>(qty) &gt; <span class="number">1000</span> ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>2. Provide pid values of all products purchased by at least two customers.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  pid</span><br><span class="line"><span class="keyword">FROM</span>    orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>  pid</span><br><span class="line"><span class="keyword">HAVING</span>  <span class="keyword">count</span> ( <span class="keyword">distinct</span>  cid ) &gt;= <span class="number">2</span> ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>3. Find the average, over all agents, of the maximum dollar sales made by each agent.</font></p>
<p><span style="background: linear-gradient(to right, #f2994a, #f2c94c);">Right：</span></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  <span class="keyword">avg</span> ( t.x )</span><br><span class="line"><span class="keyword">FROM</span> ( <span class="keyword">select</span>  aid, <span class="keyword">max</span>(dollars)  <span class="keyword">as</span>  x</span><br><span class="line">	   <span class="keyword">from</span>   orders</span><br><span class="line">	   <span class="keyword">group</span> <span class="keyword">by</span>  aid ) t ;</span><br></pre></td></tr></table></figure>
<p><span style="background: linear-gradient(to right, #f2994a, #f2c94c);">Wrong：</span></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  <span class="keyword">avg</span> ( <span class="keyword">select</span> <span class="keyword">max</span> ( dollars ) <span class="keyword">from</span> orders )</span><br><span class="line"><span class="keyword">FROM</span>    orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>  aid ;</span><br></pre></td></tr></table></figure>
<br/>
<h4 id="5-Insert-Update-and-Delete-Statements">5. Insert, Update, and Delete Statements</h4>
<p><font color = green size = 4>1) The Insert Statement</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tablename [ ( colname, ...... ) ]</span><br><span class="line"><span class="keyword">VALUES</span> ( expr|<span class="literal">NULL</span>, ...... ) | subquery</span><br></pre></td></tr></table></figure>
<br/>
<ul>
<li><font color = blue>带有子查询</font></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> T_ReaderFavorite2 (FCategoryId, FReaderId)</span><br><span class="line"><span class="keyword">SELECT</span> FCategoryId, FReaderId <span class="keyword">FROM</span> T_ReaderFavorite <span class="keyword">Where</span> ....</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color = brown>这里使用SELECT FCategoryId,FReaderId FROM T_ReaderFavorite将T_ReaderFavorite表中的数据读出，然后使用INSERT INTO T_ReaderFavorite2(FCategoryId,FReaderId)将检索结果插入到T_ReaderFavorite2 表中，注意上下的列顺序必须是<b>一一对应</b>的。</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> T_ReaderFavorite(FCategoryId,FReaderId)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span>,FId <span class="keyword">FROM</span> T_Reader <span class="keyword">Where</span> ....</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color = brown>SELECT语句从T_Reader表中检索所有的读者信息，并且将第一列设定为固定值1，而将第二列设定为读者的主键，执行完毕查看T_ReaderFavorite表中的内容。</font></p>
</blockquote>
<br/>
<p><font color = green size = 4>2) The Update Statements</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span>  tablename</span><br><span class="line"><span class="keyword">SET</span>  colname = expr | <span class="literal">NULL</span> | subquery, ......</span><br><span class="line">[ <span class="keyword">WHERE</span>  <span class="keyword">search</span>-condition ];</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>1. Give all customers who have total orders of more than $1000 a 10% increase in the discnt they receive.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span>  customers</span><br><span class="line"><span class="keyword">SET</span>  discnt = <span class="number">1.1</span> * discnt</span><br><span class="line"><span class="keyword">WHERE</span>  cid  <span class="keyword">in</span>  ( <span class="keyword">select</span>  cid</span><br><span class="line">		<span class="keyword">from</span>  orders</span><br><span class="line">		<span class="keyword">group</span>  <span class="keyword">by</span>  cid</span><br><span class="line">		<span class="keyword">having</span>  <span class="keyword">sum</span>(dollars) &gt; <span class="number">1000</span> );</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color = red size = 4>注意：</font><font color = green size = 4>可利用Select不包含聚合函数，Having包含聚合函数进行单一筛选！</font></p>
</blockquote>
<br/>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> customers c</span><br><span class="line"><span class="keyword">SET</span>  discnt = <span class="number">1.1</span> * discnt</span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">1000</span> &lt; ( <span class="keyword">Select</span> <span class="keyword">sum</span>(dollars) </span><br><span class="line">      <span class="keyword">from</span> orders o <span class="keyword">where</span> o.cid = c.cid);</span><br></pre></td></tr></table></figure>
<br/>
<ul>
<li><font color = blue>多张表UPDATE用法</font></li>
<li><font color = blue>当用一个表中的数据来更新另一个表中的数据，T-SQL提供多种写法(下面列出了二种)，但建议用第一种写法，虽然传统，但结构清晰。<br>
并且要注意，当用一个表中的数据来更新另一个表中的数据时，<font color = red>二个表一定要有关联！</font></font></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t1 <span class="keyword">set</span> t1.c2 = t2.c2</span><br><span class="line"><span class="keyword">from</span> t2 </span><br><span class="line"><span class="keyword">where</span> t1.c1 = t2.c1;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Update</span> t1 <span class="keyword">set</span> t1.c2 = t2.c2</span><br><span class="line"><span class="keyword">from</span> t1 <span class="keyword">inner</span> <span class="keyword">join</span> t2 <span class="keyword">on</span> t1.c1 = t2.c1;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Update</span> t1 <span class="keyword">set</span> t1.c2 = t2.c2</span><br><span class="line"><span class="keyword">from</span> t1 <span class="keyword">inner</span> <span class="keyword">join</span> t2 <span class="keyword">using</span>(c1);</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color = red size = 4>注意：用using关键字进行简化</font></p>
<p><font color = green size = 4>1.查询必须是等值连接。</font></p>
<p><font color = green size = 4>2.等值连接中的列必须具有相同的名称和数据类型。</font></p>
</blockquote>
<br/>
<blockquote>
<p><font color = red size = 4>表联结（join）拓展：</font></p>
</blockquote>
<p><font color = blue size = 4>相同多列联结：</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select... <span class="keyword">from</span> table1 <span class="keyword">inner</span> <span class="keyword">join</span> table2</span><br><span class="line"> </span><br><span class="line"><span class="keyword">using</span>(column1,column2)</span><br></pre></td></tr></table></figure>
<p><font color = green size = 4>相当于</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select... <span class="keyword">from</span> table1 <span class="keyword">inner</span> <span class="keyword">join</span> table2</span><br><span class="line"> </span><br><span class="line"><span class="keyword">on</span> table1.column1=table2.column1</span><br><span class="line"> </span><br><span class="line"><span class="keyword">and</span> table1.column2=table2.column2;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select... <span class="keyword">from</span> table1, table2</span><br><span class="line"> </span><br><span class="line"><span class="keyword">where</span> table1.column1=table2.column1</span><br><span class="line"> </span><br><span class="line"><span class="keyword">and</span> table1.column2=table2.column2;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>多表联结：</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select... <span class="keyword">from</span> table1</span><br><span class="line"> </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> table2 <span class="keyword">using</span>(column1)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> table3 <span class="keyword">using</span>(column2);</span><br></pre></td></tr></table></figure>
<p><font color = green size = 4>相当于</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select... <span class="keyword">from</span> table1,table2,table3</span><br><span class="line"> </span><br><span class="line"><span class="keyword">where</span> table1.column1=table2.column1</span><br><span class="line"> </span><br><span class="line"><span class="keyword">and</span> table1.column2=table3.column2;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select... <span class="keyword">from</span> table1 </span><br><span class="line"></span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> table2 <span class="keyword">on</span> table1.column1=table2.column1</span><br><span class="line"> </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> table3 <span class="keyword">on</span> table1.column2=table3.column2;</span><br></pre></td></tr></table></figure>
<br/>
<ul>
<li><font color = blue>FROM 子句中指定的表的别名不能作为 SET column_name 子句中<font color = red>被修改字段</font>的限定符使用。</font></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> titles</span><br><span class="line"><span class="keyword">SET</span> t.ytd_sales = t.ytd_sales + s.qty   <span class="comment">--此处的t.ytd_sales使用不当</span></span><br><span class="line"><span class="keyword">FROM</span> titles t, sales s</span><br><span class="line"><span class="keyword">WHERE</span> t.title_id = s.title_id</span><br><span class="line"><span class="keyword">AND</span> s.ord_date = (<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(sales.ord_date) <span class="keyword">FROM</span> sales);</span><br></pre></td></tr></table></figure>
<ul>
<li><font color = blue>若要使上例合法，请从列名中删除别名 t 或使用本身的表名。</font></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> titles</span><br><span class="line"><span class="keyword">SET</span> ytd_sales = t.ytd_sales + s.qty     <span class="comment">--将别名t改为表名</span></span><br><span class="line"><span class="keyword">FROM</span> titles t, sales s</span><br><span class="line"><span class="keyword">WHERE</span> t.title_id = s.title_id</span><br><span class="line"><span class="keyword">AND</span> s.ord_date = (<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(sales.ord_date) <span class="keyword">FROM</span> sales);</span><br></pre></td></tr></table></figure>
<br/>
<ul>
<li><font color = blue>更新多列</font></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> mytab a </span><br><span class="line"><span class="keyword">set</span> (<span class="keyword">name</span>,address)=(<span class="keyword">select</span> b.name,b.address </span><br><span class="line"><span class="keyword">from</span> goal b </span><br><span class="line"><span class="keyword">where</span> b.id=a.id)</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">exists</span> (<span class="keyword">select</span> <span class="number">1</span> </span><br><span class="line"><span class="keyword">from</span> goal b</span><br><span class="line"><span class="keyword">where</span> b.id=a.id );</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color = red size = 4>1. 多表关联update的时候,记得要加exists()条件,否则不满足条件的记录被update称NULL：<br>
比如：stu表存在,但stu1表不存在的数据,对应的字段会被update成NULL;</font></p>
<p><font color = red size = 4>2. oracle在进行更新时无法join,  所以我们用exists来进行连表条件查询,相当于mytab表和goal表关联，当id相等时才执行更新！</font></p>
</blockquote>
<br/>
<ul>
<li><font color = blue >Update与判断操作的结合</font></li>
</ul>
<blockquote>
<p><font color = green size = 4>1. if(true,a,b),  if(false,a,b) 这个就是第一个如果是true，就等于a，false就等于b，有点像三元表达式</font></p>
<p><font color = green size = 4>2. case when  then else end</font></p>
</blockquote>
<p><font color = red size = 4>(Eg.)性别互换：</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> salary <span class="keyword">set</span> sex = <span class="keyword">if</span>(sex = <span class="string">'m'</span>,<span class="string">'f'</span>,<span class="string">'m'</span>);</span><br><span class="line"><span class="keyword">select</span> (<span class="keyword">case</span> sex <span class="keyword">when</span> <span class="string">'男'</span> <span class="keyword">then</span> <span class="string">'女'</span> <span class="keyword">when</span> <span class="string">'女'</span> <span class="keyword">then</span> <span class="string">'男'</span> <span class="keyword">end</span> ) <span class="keyword">from</span> salary;</span><br><span class="line"><span class="keyword">update</span> salary <span class="keyword">set</span> sex = <span class="keyword">case</span> sex <span class="keyword">when</span> <span class="string">'f'</span> <span class="keyword">then</span> <span class="string">'m'</span> <span class="keyword">else</span> <span class="string">'f'</span> <span class="keyword">end</span> ;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = green size = 4>3) The Delete Statement</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span></span><br><span class="line"><span class="keyword">FROM</span>  tablename</span><br><span class="line">[ <span class="keyword">WHERE</span>  <span class="keyword">search</span>-condition ] </span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> c1, c2, ...]</span><br><span class="line">[<span class="keyword">LIMIT</span> <span class="keyword">row_count</span>];</span><br></pre></td></tr></table></figure>
<br/>
<ul>
<li>
<p><font color = blue>多表删除</font></p>
</li>
<li>
<p><font color = blue>多表删除是指从一个或多个表中删除满足条件的数据，其中的 table_references代表了多个表的join操作，例如以下两个例子代表</font></p>
</li>
<li>
<p><font color = blue>从t 1和t 2表中删除满足条件的数据</font></p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> somelog <span class="keyword">WHERE</span> <span class="keyword">user</span> = <span class="string">'jcole'</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> timestamp_column <span class="keyword">LIMIT</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">DELETE</span> t1, t2 <span class="keyword">FROM</span> t1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> t2 <span class="keyword">on</span> t1.id=t2.id <span class="keyword">INNER</span> <span class="keyword">JOIN</span> t3 <span class="keyword">on</span> t1.id=t3.id;</span><br></pre></td></tr></table></figure>
<br/>
<ul>
<li><font color = blue>对多表删除语句而言，如果想对表使用别名，则只能在 table_references子句中使用，否则会报错。</font></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> a1, a2 <span class="keyword">FROM</span> t1 <span class="keyword">AS</span> a1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> t2 <span class="keyword">AS</span> a2 <span class="keyword">ON</span> a1.id=a2.id;      <span class="comment">-- 正确</span></span><br><span class="line"><span class="keyword">DELETE</span> t1 <span class="keyword">AS</span> a1, t2 <span class="keyword">AS</span> a2 <span class="keyword">FROM</span> t1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> t2 <span class="keyword">WHERE</span> a1.id=a2.id;      <span class="comment">-- 错误</span></span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>1. Give all agents in New York a 10% raise in the percent commission they earn on an order.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span>  agents</span><br><span class="line"><span class="keyword">SET</span>  <span class="keyword">percent</span> = <span class="number">1.1</span> * <span class="keyword">percent</span></span><br><span class="line"><span class="keyword">WHERE</span>  city = ‘<span class="keyword">New</span> York’;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>2. Give all customers who have total orders of more than $1000 a 10% increase in the discnt they receive.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span>  customers</span><br><span class="line"><span class="keyword">SET</span>  discnt = <span class="number">1.1</span> * discnt</span><br><span class="line"><span class="keyword">WHERE</span>  cid  <span class="keyword">in</span>  ( <span class="keyword">select</span>  cid</span><br><span class="line"><span class="keyword">from</span>  orders</span><br><span class="line"><span class="keyword">group</span>  <span class="keyword">by</span>  cid</span><br><span class="line"><span class="keyword">having</span>  <span class="keyword">sum</span>(dollars) &gt; <span class="number">1000</span> );</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>3. Delete all agents in New York.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span>  <span class="keyword">FROM</span>  agents</span><br><span class="line"><span class="keyword">WHERE</span>  city = ‘<span class="keyword">New</span> York’;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>4. Delete all agents who have total orders of less than $600.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span>  <span class="keyword">FROM</span>  agents</span><br><span class="line"><span class="keyword">WHERE</span>  aid  <span class="keyword">IN</span>  (</span><br><span class="line"><span class="keyword">select</span>  aid</span><br><span class="line"><span class="keyword">from</span>  orders</span><br><span class="line"><span class="keyword">group</span>  <span class="keyword">by</span>  aid</span><br><span class="line"><span class="keyword">having</span>  <span class="keyword">sum</span>(dollars) &lt; <span class="number">600</span>  );</span><br></pre></td></tr></table></figure>
<br/>
<hr>
<h2 id="Ch4-Object-Relational-SQL">Ch4.Object-Relational SQL</h2>
<h3 id="一-Object-Types">一. Object Types</h3>
<h4 id="1-定义新的数据类型（对象类型）">1.定义新的数据类型（对象类型）</h4>
<ul>
<li><font color = blue size = 4>对象类型的创建与删除</font></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span>  <span class="keyword">TYPE</span>  typename  <span class="keyword">AS</span>  <span class="keyword">OBJECT</span></span><br><span class="line">(attrname  datatype, ......);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span>  <span class="keyword">TYPE</span>  typename;</span><br></pre></td></tr></table></figure>
<br/>
<ul>
<li><font color = blue size = 4>创建一个 ’姓名’(name_t) 类型</font></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TYPE</span> name_t <span class="keyword">AS</span> <span class="keyword">OBJECT</span> (</span><br><span class="line">lname  <span class="built_in">varchar</span>(<span class="number">30</span>),</span><br><span class="line">fname  <span class="built_in">varchar</span>(<span class="number">30</span>),</span><br><span class="line">mi  <span class="built_in">char</span>(<span class="number">1</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<br/>
<h4 id="2-对象类型的使用方法">2.对象类型的使用方法</h4>
<ul>
<li><font color = blue size = 4>使用已有的对象类型来创建新的类型或表</font></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span>  <span class="keyword">TYPE</span>  person_t  <span class="keyword">AS</span>  <span class="keyword">OBJECT</span> (</span><br><span class="line">ssno          <span class="built_in">int</span>,</span><br><span class="line">pname      	  name_t,    <span class="comment">-- (类型的嵌套定义关系)</span></span><br><span class="line">age           <span class="built_in">int</span>  );</span><br></pre></td></tr></table></figure>
<br/>
<h4 id="3-使用对象数据类型来直接创建一张表">3.使用对象数据类型来直接创建一张表</h4>
<ul>
<li><font color = blue size = 4>  CREATE TABLE tablename OF typename<br>
{  ( constraint-define ) } ;</font></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span>  <span class="keyword">TABLE</span>  people  <span class="keyword">OF</span>  person_t (PRIMARY  <span class="keyword">KEY</span>(ssno)) ;</span><br></pre></td></tr></table></figure>
<br/>
<h4 id="4-对象值的创建、查询与更新">4.对象值的创建、查询与更新</h4>
<ul>
<li><font color = blue size = 4>对象值的创建</font></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Insert</span>  <span class="keyword">into</span>  teachers  <span class="keyword">values</span></span><br><span class="line">(<span class="number">1234</span>, name_t(‘Einstein’, ‘Albert’, ‘E’), <span class="number">120</span>);  <span class="comment">-- 对象构造函数</span></span><br></pre></td></tr></table></figure>
<ul>
<li><font color = blue size = 4>对象值的查询</font></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span>   t.tid, t.name_t.fname, t.name_t.lname</span><br><span class="line"><span class="keyword">From</span>    teachers  t</span><br><span class="line"><span class="keyword">Where</span>  t.room = <span class="number">123</span></span><br></pre></td></tr></table></figure>
<ul>
<li><font color = blue size = 4>对象值的更新</font></li>
</ul>
<p><font color = green size = 4>1) 修改元组中的对象属性值</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span>  people  p</span><br><span class="line"><span class="keyword">set</span>  p.pname = name_t(<span class="string">'Gould'</span>, <span class="string">'Ben'</span>, <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">where</span>  ssno = <span class="number">321341223</span>;</span><br></pre></td></tr></table></figure>
<p><font color = green size = 4>2) 修改某个对象属性值的成员属性</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span>  people  p</span><br><span class="line"><span class="keyword">set</span>  p.pname.mi = ‘C’</span><br><span class="line"><span class="keyword">where</span>  ssno = <span class="number">321341223</span>;</span><br></pre></td></tr></table></figure>
<p><font color = green size = 4>3) 修改整个元组</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span>  people  p</span><br><span class="line"><span class="keyword">set</span>  p = person_t (</span><br><span class="line"><span class="number">332341223</span>,</span><br><span class="line">name_t(<span class="string">'Gould'</span>, <span class="string">'Glen'</span>, <span class="string">'A'</span>), <span class="number">55</span> )</span><br><span class="line"><span class="keyword">where</span>  ssno = <span class="number">321341223</span>;</span><br></pre></td></tr></table></figure>
<br/>
<h4 id="5-对象的引用类型">5.对象的引用类型</h4>
<ul>
<li><font color = blue size = 4>对象的引用类型：REF  &lt; object type &gt;</font></li>
</ul>
<blockquote>
<ol>
<li>
<p>是指向某个元组对象的指针类型</p>
</li>
<li>
<p>可用于实现对象类型之间的嵌套引用</p>
</li>
</ol>
</blockquote>
<br/>
<ul>
<li><font color = blue size = 4>在使用含有 REF类型的对象类型(Object Type)来创建关系表时，必须使用<span style="background: linear-gradient(to right, #f2994a, #f2c94c);">Scope for子句来限制REF属性的取值范围</span>。</font></li>
</ul>
<p><font color = red size =4>1) 定义类型之间的引用关系</font></p>
<blockquote>
<p><font color = brown size = 4>定义基本的对象类型：</font><br>
<font color = green size = 4>customer_t,  agents_t,  products_t</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span>  <span class="keyword">type</span> customer_t <span class="keyword">as</span> <span class="keyword">object</span> (</span><br><span class="line">cid  <span class="built_in">char</span>(<span class="number">4</span>),</span><br><span class="line">cname  <span class="built_in">varchar</span>(<span class="number">13</span>),</span><br><span class="line">city  <span class="built_in">varchar</span>(<span class="number">20</span>),</span><br><span class="line">discnt  <span class="built_in">real</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span>  <span class="keyword">type</span>  agent_t <span class="keyword">as</span> <span class="keyword">object</span> (  </span><br><span class="line">aid  <span class="built_in">char</span>(<span class="number">3</span>),</span><br><span class="line">aname  <span class="built_in">varchar</span>(<span class="number">13</span>),</span><br><span class="line">city  <span class="built_in">varchar</span>(<span class="number">20</span>),</span><br><span class="line"><span class="keyword">percent</span>  <span class="built_in">smallint</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span>  <span class="keyword">type</span>  product_t <span class="keyword">as</span> <span class="keyword">object</span> (</span><br><span class="line">pid  <span class="built_in">char</span>(<span class="number">3</span>),</span><br><span class="line">pname  <span class="built_in">varchar</span>(<span class="number">13</span>),</span><br><span class="line">city  <span class="built_in">varchar</span>(<span class="number">20</span>),</span><br><span class="line">quantity  <span class="built_in">integer</span>,</span><br><span class="line">price  <span class="keyword">double</span>  <span class="keyword">precision</span>);</span><br></pre></td></tr></table></figure>
<br/>
<blockquote>
<p><font color = brown size = 4>定义类型之间的引用关系 :</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">type</span> order_t <span class="keyword">as</span> <span class="keyword">object</span>  (</span><br><span class="line">ordno      <span class="built_in">int</span>,</span><br><span class="line"><span class="keyword">month</span>      <span class="built_in">char</span>(<span class="number">3</span>),</span><br><span class="line">cid        <span class="built_in">char</span>(<span class="number">4</span>),</span><br><span class="line">aid        <span class="built_in">char</span>(<span class="number">3</span>),</span><br><span class="line">pid        <span class="built_in">char</span>(<span class="number">3</span>),</span><br><span class="line">qty        <span class="built_in">int</span>,</span><br><span class="line">dollars    <span class="keyword">double</span> <span class="keyword">precision</span>,  </span><br><span class="line">ordcust    <span class="keyword">ref</span>  customer_t,</span><br><span class="line">ordagent   <span class="keyword">ref</span>  agent_t,</span><br><span class="line">ordprod    <span class="keyword">ref</span>  product_t);</span><br></pre></td></tr></table></figure>
<p><span style="background: linear-gradient(to right, #f2994a, #f2c94c);"><font color = blue size = 4>(新增三个REF属性，分别引用（指向）三个不同的元组对象（Row Object）)</font></span></p>
<br/>
<p><font color = red size = 5>2) 创建含有引用类型的关系表</font></p>
<blockquote>
<p><font color = brown size = 4>使用前面定义的对象类型创建基本关系表 :</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> customers <span class="keyword">of</span> customer_t</span><br><span class="line">(primary <span class="keyword">key</span> (cid));</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> products <span class="keyword">of</span> product_t</span><br><span class="line">(primary <span class="keyword">key</span> (pid));</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> agents <span class="keyword">of</span> agent_t</span><br><span class="line">(primary <span class="keyword">key</span> (aid));</span><br></pre></td></tr></table></figure>
<br/>
<blockquote>
<p><font color = brown size = 4>创建含有引用类型的关系表</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> orders <span class="keyword">of</span> order_t  (</span><br><span class="line">    primary <span class="keyword">key</span> (ordno),</span><br><span class="line">    <span class="keyword">scope</span> <span class="keyword">for</span> (ordcust)  <span class="keyword">is</span>  customers,</span><br><span class="line">    <span class="keyword">scope</span> <span class="keyword">for</span> (ordagent) <span class="keyword">is</span>  agents,</span><br><span class="line">    <span class="keyword">scope</span> <span class="keyword">for</span> (ordprod)  <span class="keyword">is</span>  products );</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = red size = 5>3) 引用关系查询</font></p>
<blockquote>
<p><font color = brown size = 4>根据元组之间的REF引用关系进行查询</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>   o.ordno, o.ordcust.cname</span><br><span class="line"><span class="keyword">from</span>     orders  o</span><br><span class="line"><span class="keyword">where</span>  o.dollars &gt; <span class="number">200.00</span></span><br></pre></td></tr></table></figure>
<p><font color = blue size = 4>1. Find pid values of products that have been ordered by at least two customers.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  <span class="keyword">distinct</span>  x1.pid </span><br><span class="line"><span class="keyword">from</span>    orders x1, orders x2</span><br><span class="line"> <span class="keyword">where</span>  x1.pid = x2.pid <span class="keyword">and</span> x1.ordcust &lt; x2.ordcust;</span><br></pre></td></tr></table></figure>
<p><span style="background: linear-gradient(to right, #f2994a, #f2c94c);"><font color = green size = 4>ordcust 承担起了 cid 所担负的责任！</font></span></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  <span class="keyword">distinct</span>  x1.pid </span><br><span class="line"><span class="keyword">from</span>    orders x1, orders x2</span><br><span class="line"><span class="keyword">where</span>  x1.pid = x2.pid <span class="keyword">and</span> x1.cid &lt; x2.cid;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = red size = 5>4) 函数与谓词</font></p>
<ul>
<li><font color = blue size = 4>函数与谓词</font></li>
</ul>
<blockquote>
<p>1.获取对象(元组)的引用指针: REF(……)</p>
<p>2.返回引用指针所指向对象的值: DEREF(……)</p>
</blockquote>
<br/>
<ul>
<li>
<p><font color = blue size = 4>两个谓词</font></p>
<ul>
<li>
<p><span style="background: linear-gradient(to right, #f2994a, #f2c94c);">IS DANGLING</span></p>
<blockquote>
<ol>
<li>
<p>用于判断所引用的元组对象是否存在</p>
</li>
<li>
<p>如果所引用的元组对象不存在，那么该谓词返回逻辑真(TRUE)，否则返回逻辑假(FALSE)。</p>
</li>
<li>
<p>该谓词主要用于检查那些错误的对象引用指针。</p>
</li>
</ol>
</blockquote>
</li>
<li>
<p><span style="background: linear-gradient(to right, #f2994a, #f2c94c);">IS NULL</span></p>
</li>
</ul>
</li>
</ul>
<br/>
<p><font color = blue size = 4>1. Retrieve all customer names where the customer does not place an order through agent a05.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  c.cname</span><br><span class="line"><span class="keyword">from</span>   customers  c</span><br><span class="line"><span class="keyword">where</span>  <span class="keyword">not</span> <span class="keyword">exists</span> (</span><br><span class="line"><span class="keyword">select</span>  *  <span class="keyword">from</span> orders x </span><br><span class="line"><span class="keyword">where</span>  x.ordcust = <span class="keyword">ref</span>(c) <span class="keyword">and</span> x.aid = <span class="string">'a05‘ );</span></span><br></pre></td></tr></table></figure>
<br/>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  o.cid    <span class="keyword">from</span>  orders o</span><br><span class="line"><span class="keyword">where</span>  o.ordcust  <span class="keyword">IS</span> DANGLING;</span><br></pre></td></tr></table></figure>
<p><font color = green size = 4>等价于：</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> o.cid   <span class="keyword">from</span> orders o</span><br><span class="line"><span class="keyword">where</span> o.ordcust &lt;&gt;</span><br><span class="line">(<span class="keyword">select</span> <span class="keyword">ref</span>(c) <span class="keyword">from</span> customers c</span><br><span class="line"><span class="keyword">where</span> c.cid = o.cid)</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = red size = 5>5) 类型的循环嵌套定义</font></p>
<ul>
<li><font color = blue size = 4>对象类型(object type)不能嵌套定义，但 REF 关系可以实现嵌套引用。</font></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span>  <span class="keyword">type</span>  police_officer_t <span class="keyword">as</span> <span class="keyword">object</span></span><br><span class="line">( pol_person   person_t,</span><br><span class="line">  badge_number <span class="built_in">integer</span>,</span><br><span class="line">  partner  <span class="keyword">ref</span> police_officer_t );</span><br></pre></td></tr></table></figure>
<br/>
<ul>
<li><font color = blue size = 4>可以使用对象类型 police_officer_t 来创建表</font></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> police_officers <span class="keyword">of</span> police_officer_t</span><br><span class="line">( primary <span class="keyword">key</span> (badge_number),</span><br><span class="line">  <span class="keyword">scope</span> <span class="keyword">for</span> (partner) <span class="keyword">is</span> police_officers );</span><br></pre></td></tr></table></figure>
<br/>
<ul>
<li><font color = blue size = 4>在表 police_officers 上的对象查询的例子</font></li>
</ul>
<p><font color = green size = 4>1. Retrieve the last names of all police officers who have partners over sixty years of age.</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  p.pol_person.pname.lname</span><br><span class="line"><span class="keyword">from</span>    police_officers  p</span><br><span class="line"><span class="keyword">where</span>   p.partner.pol_person.age &gt; <span class="number">60</span>;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = red size = 5>6) 其它约束</font></p>
<ul>
<li><font color = blue size = 4>有关 REF定义的其它约束 (REF Dependencies)</font></li>
</ul>
<p><font color = green size = 4>1)  两张表之间的相互 REF关系的定义</font></p>
<blockquote>
<ol>
<li>
<p>首先，定义两个具有相互REF关系的对象类型 (create type …… )</p>
</li>
<li>
<p>再用创建好的对象类型创建关系表</p>
</li>
</ol>
</blockquote>
<br/>
<p><font color = green size  = 4>2)  两个具有相互REF关系的表/类型的删除</font></p>
<blockquote>
<ol>
<li>
<p>在删除类型(drop type)之前需要先删除表(drop table)</p>
</li>
<li>
<p>在删除类型(drop type)时需要采用强制删除的方式</p>
</li>
</ol>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TYPE</span> typename <span class="keyword">FORCE</span>;</span><br></pre></td></tr></table></figure>
<br/>
<blockquote>
<p>先不管REF属性的赋值(先置为NULL)，然后再使用UPDATE操作修改REF属性上的取值</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span>  orders  o</span><br><span class="line"> <span class="keyword">set</span>   ordcust = (<span class="keyword">select</span> <span class="keyword">ref</span>(c) <span class="keyword">from</span> customers c</span><br><span class="line">                        <span class="keyword">where</span> c.cid = o.cid),</span><br><span class="line">     ordagent = (<span class="keyword">select</span> <span class="keyword">ref</span>(a) <span class="keyword">from</span> agents a</span><br><span class="line">                        <span class="keyword">where</span> a.aid = o.aid),</span><br><span class="line">     ordprod = (<span class="keyword">select</span> <span class="keyword">ref</span>(p) <span class="keyword">from</span> products p</span><br><span class="line">                        <span class="keyword">where</span> p.pid = o.pid);</span><br></pre></td></tr></table></figure>
<br/>
<hr>
<h3 id="二-Collection-Types-集合类型">二. Collection Types(集合类型)</h3>
<h4 id="1-Table-Types-Nested-Tables">1.Table Types ( Nested Tables )</h4>
<p><font color = blue size = 4>1) 创建一个新的表类型 (table type)</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span>  <span class="keyword">TYPE</span>  dependents_t</span><br><span class="line"><span class="keyword">AS</span>  <span class="keyword">TABLE</span>  <span class="keyword">OF</span>  person_t;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>2) 使用类型dependents_t来定义表employees中的属性并形成一个嵌套表(nested table)定义。</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> employees (</span><br><span class="line">    eid       <span class="built_in">int</span>,</span><br><span class="line">    eperson   person_t,</span><br><span class="line">    dependents  dependents_t,</span><br><span class="line">    primary <span class="keyword">key</span> (eid)</span><br><span class="line">) <span class="keyword">nested</span> <span class="keyword">table</span> dependents <span class="keyword">store</span> <span class="keyword">as</span> dependents_tab;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = blue size = 4>3) Nested table的访问</font></p>
<ul>
<li>
<p><font color = red size = 4>table ( … ) 的使用</font><br></p>
<p><font color = brown size = 4>Oracle 不支持直接对嵌套表属性的统计查询功能，即下述的统计查询操作是错误的：</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  <span class="keyword">count</span>(e.dependents)</span><br><span class="line"><span class="keyword">from</span>    employees  e </span><br><span class="line"><span class="keyword">where</span>  e.eid = <span class="number">101</span>;</span><br></pre></td></tr></table></figure>
<p><font color = brown size = 4>应为：</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span>  <span class="keyword">count</span>(*)</span><br><span class="line"><span class="keyword">From</span>   <span class="keyword">table</span> (</span><br><span class="line">    <span class="keyword">select</span> e.dependents</span><br><span class="line">    <span class="keyword">from</span> employees e  <span class="keyword">where</span> e.eid = <span class="number">101</span>);</span><br></pre></td></tr></table></figure>
<br/>
</li>
<li>
<p><font color = red size = 4>Oracle 数据库没有提供 nested table 的相等比较运算。</font><br></p>
<p><font color = brown size = 4>可以使用 IN 操作符来实现某些需要通过 nested table 进行的查询功能</font></p>
<br/>
</li>
<li>
<p><font color = red size = 4>Oracle提供了单个对象的相等比较功能</font></p>
<p><font color = blue size = 4>1. Retrieve eids with dependents that have name given by<br>
name_t(‘Lukas’, ‘David’, ‘E’)</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  eid  <span class="keyword">from</span>  employees e</span><br><span class="line"><span class="keyword">where</span>  name_t(‘Lukas’, ‘David’, ‘E’) <span class="keyword">in</span> </span><br><span class="line">      ( <span class="keyword">select</span>  d.pname</span><br><span class="line">        <span class="keyword">from</span>  <span class="keyword">table</span>(e.dependents)  d);</span><br></pre></td></tr></table></figure>
<br/>
</li>
<li>
<p><font color = red size = 4>Nested Cursors （嵌套游标）</font><br></p>
<p><font color = brown size = 4>(i) 普通的查询操作</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.eid, d.ssno <span class="keyword">as</span> dep_sso</span><br><span class="line"><span class="keyword">from</span> employees e, <span class="keyword">table</span>(e.dependents) d</span><br><span class="line"><span class="keyword">where</span> d.age &lt; <span class="number">16</span>;</span><br></pre></td></tr></table></figure>
<br/>
<p><font color = brown size = 4>(ii) 使用 nested cursor 的查询操作</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.eid, <span class="keyword">cursor</span>(<span class="keyword">select</span> d.ssno <span class="keyword">as</span> dep_ssno </span><br><span class="line"><span class="keyword">from</span> <span class="keyword">table</span>(e.dependents) d</span><br><span class="line"><span class="keyword">where</span> d.age &lt; <span class="number">16</span>) dep_tab</span><br><span class="line"><span class="keyword">from</span> employees e;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<br/>
<h4 id="2-Array-Types">2.Array Types</h4>
<p><font color = blue size = 4>1) Array Types for VARRAYs</font></p>
<blockquote>
<p><font color = green size = 4>1. 自定义一个TYPE使用 VARRAY来得到一个数组但只能对基本类型定义。</font></p>
<p><font color = green size = 4>2. VARRAY数据结构可存储相同类型元素的一个固定大小的连续集合。</font><br>
<font color = green size = 4>3. VARRAY用于存储数据的有序集合，但它往往是更加有用认为数组作为相同类型的变量的集合。</font></p>
</blockquote>
<br/>
<ul>
<li><font color = red size = 4>一个VARRAY类型是用CREATE TYPE语句创建。必须指定最大长度，并存储在 VARRAY元素的类型。<br>
PL/SQL 块创建 VRRAY类型的基本语法：</font></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TYPE  varray_type_name  IS  VARRAY(n) of &lt;element_type&gt;</span><br></pre></td></tr></table></figure>
<br/>
<blockquote>
<p><font color = blue size = 4>create type extensions_t as varray(<span style="background: linear-gradient(to right, #f2994a, #f2c94c);">4</span>) of <span style="background: linear-gradient(to right, #f2994a, #f2c94c);">int</span>;</font></p>
<p><font color = blue size = 4>使用 Array Types 定义表中的属性</font></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span>  <span class="keyword">table</span>  phonebook  (</span><br><span class="line">phperson   person_t,</span><br><span class="line">extensions  extensions_t );</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
    
        <div class="reward-container">
  <div>大爷，赏点？</div>
  <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Rocky Zhou 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="Rocky Zhou 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Rocky Zhou
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://blog.zxkidea.top/posts/928c862a.html" title="DatabaseNotes-Ch3,4">https://blog.zxkidea.top/posts/928c862a.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="fa fa-tag"></i> 数据库</a>
              <a href="/tags/%E8%80%83%E7%A0%94/" rel="tag"><i class="fa fa-tag"></i> 考研</a>
              <a href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag"><i class="fa fa-tag"></i> 笔记</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/786bf771.html" rel="prev" title="DatabaseNotes-Ch1,2">
      <i class="fa fa-chevron-left"></i> DatabaseNotes-Ch1,2
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/780f9bb4.html" rel="next" title="DatabaseNotes-Ch5,6">
      DatabaseNotes-Ch5,6 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>

  
  
  



  </div>


          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Ch3-Basic-SQL-Query-Language"><span class="nav-text">Ch3:  Basic SQL Query Language</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一-Setting-up-the-Database"><span class="nav-text">一. Setting up the Database</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-SQL-Datatype"><span class="nav-text">1. SQL  Datatype</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Oracle-Datatype"><span class="nav-text">2.Oracle  Datatype</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-SQL-Statement"><span class="nav-text">3.SQL  Statement</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-SQL-statements-for-table-creation-for-CAP-database"><span class="nav-text">1)  SQL statements for table creation for CAP database</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-Select-Statement"><span class="nav-text">2) Select Statement</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二-Simple-Select-Statements"><span class="nav-text">二. Simple Select Statements</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Relational-Algebra与SQL语法对比"><span class="nav-text">1. Relational Algebra与SQL语法对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Some-Examples"><span class="nav-text">2. Some Examples</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Table-and-column-alias"><span class="nav-text">3. Table and column alias</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-ALL-DISTINCT"><span class="nav-text">4. ALL  |  DISTINCT</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三-Subqueries"><span class="nav-text">三. Subqueries</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-The-IN-Predicate"><span class="nav-text">1. The IN Predicate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-The-Quantified-Comparison-Predicate"><span class="nav-text">2. The Quantified Comparison Predicate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-The-EXISTS-Predicate"><span class="nav-text">3. The EXISTS Predicate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-The-LIKE-Predicate"><span class="nav-text">4. The LIKE Predicate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-The-NULL-Predicate"><span class="nav-text">5. The NULL Predicate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-Example-of-Subqueries"><span class="nav-text">6.Example  of Subqueries</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四-UNION-Operators-and-FOR-ALL-Conditions"><span class="nav-text">四.UNION Operators and FOR ALL Conditions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-The-UNION-Operator-并集-交集拓展"><span class="nav-text">1. The UNION Operator(并集&#x2F;交集拓展)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-The-span-style-background-linear-gradient-to-right-f2994a-f2c94c-Division-Operation-span-in-Relational-Algebra"><span class="nav-text">2. The Division Operation in Relational Algebra</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Set-Functions-in-SQL-聚合函数"><span class="nav-text">3.  Set Functions in SQL(聚合函数)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-Groups-of-Rows-in-SQL"><span class="nav-text">4. Groups of Rows in SQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-Insert-Update-and-Delete-Statements"><span class="nav-text">5. Insert, Update, and Delete Statements</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ch4-Object-Relational-SQL"><span class="nav-text">Ch4.Object-Relational SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一-Object-Types"><span class="nav-text">一. Object Types</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-定义新的数据类型（对象类型）"><span class="nav-text">1.定义新的数据类型（对象类型）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-对象类型的使用方法"><span class="nav-text">2.对象类型的使用方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-使用对象数据类型来直接创建一张表"><span class="nav-text">3.使用对象数据类型来直接创建一张表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-对象值的创建、查询与更新"><span class="nav-text">4.对象值的创建、查询与更新</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-对象的引用类型"><span class="nav-text">5.对象的引用类型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二-Collection-Types-集合类型"><span class="nav-text">二. Collection Types(集合类型)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Table-Types-Nested-Tables"><span class="nav-text">1.Table Types ( Nested Tables )</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Array-Types"><span class="nav-text">2.Array Types</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Rocky Zhou"
      src="/images/cat.jpg">
  <p class="site-author-name" itemprop="name">Rocky Zhou</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element">
    <a onclick="tidioChatApi.open();"><i class="fa fa-comment"></i>
    Chat
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Joyrocky" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Joyrocky" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:kevin009008@outlook.com" title="E-Mail → mailto:kevin009008@outlook.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/2932742182/" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;2932742182&#x2F;" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/profile.php?id=100011389486139" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100011389486139" rel="noopener" target="_blank"><i class="fa fa-fw fa-facebook"></i>FB Page</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">苏ICP备19021225号 </a>
  </div>

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rocky Zhou</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">146k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">2:13</span>
</div>
  <div class="addthis_inline_share_toolbox">
    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e19b902cd7cfa55" async="async"></script>
  </div>

        
<div class="busuanzi-count">
  <script pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.getAttribute('pjax') !== null) {
      element.setAttribute('pjax', '');
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>






  <script src="//code.tidio.co/wzwxqvlketmhjegc6hongvrouugosmo5.js"></script>







    <div id="pjax">
  

  
      
<script type="text/x-mathjax-config">
    MathJax.Ajax.config.path['mhchem'] = '//cdn.jsdelivr.net/npm/mathjax-mhchem@3';

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        extensions: ['[mhchem]/mhchem.js'],
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el: '#valine-comments',
      verify: false,
      notify: false,
      appId: 'lovislz0MGuQcCOyeHoO0dsC-gzGzoHsz',
      appKey: 'sGUVwBk9sdrntxYQJaP0gw6G',
      placeholder: "Just go go",
      avatar: 'mp',
      meta: guest,
      pageSize: '10' || 10,
      visitor: false,
      lang: 'zh-cn' || 'zh-cn',
      path: location.pathname,
      recordIP: false,
      serverURLs: ''
    });
  }, window.Valine);
});
</script>

    </div>

  <script type="text/javascript" src="/lib/clipboard/clipboard.js"></script>
<script type="text/javascript" src="/js/custom.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":220,"height":325,"hOffset":-20,"vOffset":-30},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script></body>
</html>
